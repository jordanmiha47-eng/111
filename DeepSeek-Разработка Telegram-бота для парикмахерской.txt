user: –∏—Å—Å–ª–µ–¥—É–π —Ñ–∞–π–ª –Ω–∞ 100% –∞ –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–º—Ç—ã –≤ –∫–æ–Ω—Ü–µ —á–∞—Ç–∞ –∏–ª–∏ —Ñ–∞–π–ª–∞ –±—É–¥—Ç–æ —è –¥–∞–ª —Ç–µ–±–µ –∏—Ö  –≤—á–∞—Ç–µ

assistant: –î—É–º–∞–ª 209 —Å–µ–∫—É–Ω–¥–ú—ã —É–∂–µ –ø—Ä–æ–¥–µ–ª–∞–ª–∏ –±–æ–ª—å—à—É—é —Ä–∞–±–æ—Ç—É –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –±–æ—Ç–∞ –¥–ª—è –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π. –¢–µ–ø–µ—Ä—å —è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –≤–µ—Å—å –Ω–∞—à –¥–∏–∞–ª–æ–≥ –∏ —Ñ–∞–π–ª, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –∏ —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å.–ò–∑ –∏—Å—Ç–æ—Ä–∏–∏ –≤–∏–¥–Ω–æ, —á—Ç–æ –º—ã –ø—Ä–æ—à–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤:–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞ gold365s.in (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–æ–º —Å–∞–π—Ç–µ)–ó–∞–ø—Ä–æ—Å –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ Python –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–º–Ω–æ–≥–æ Telegram-–±–æ—Ç–∞–ò–∑—É—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Hugging Face Transformers–ü–æ–¥–±–æ—Ä –º–æ–¥–µ–ª–µ–π –¥–ª—è –±–æ—Ç–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ Google Colab–°–æ–∑–¥–∞–Ω–∏–µ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ Telegram-–±–æ—Ç–∞ –¥–ª—è –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π AI–ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –±–æ—Ç–∞, –≤–∫–ª—é—á–∞—è –ª–æ–≥–∏–∫—É –∑–∞–ø–∏—Å–∏, –∫–∞–ª–µ–Ω–¥–∞—Ä—å, –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏, –∞–¥–º–∏–Ω–∫—É, –ø–∞–Ω–µ–ª—å –º–∞—Å—Ç–µ—Ä–∞, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫.–í –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –¥–æ–¥–µ–ª–∞—Ç—å –≤—Å–µ –¥–æ –∫–æ–Ω—Ü–∞, —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –¥–æ 6 –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –∏ –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.–ú—ã —É–∂–µ –∏–º–µ–µ–º 6 –±–ª–æ–∫–æ–≤ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º –æ—Ç–≤–µ—Ç–µ, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—Å–µ –ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:–õ–æ–≥–∏–∫–∞ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏/–∏–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∏ –≤ 3-4 –∫–ª–∏–∫–∞ - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (4 –∫–ª–∏–∫–∞: —É—Å–ª—É–≥–∞, –º–∞—Å—Ç–µ—Ä, –¥–∞—Ç–∞, –≤—Ä–µ–º—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ - –Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —ç—Ç–æ 5-–π –∫–ª–∏–∫, –æ–¥–Ω–∞–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—Å–∏–ª—Å—è –Ω–∞ 4 –∫–ª–∏–∫–∞ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –≤ –æ–¥–Ω–æ–º –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π)–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏, –≤—ã—Ö–æ–¥–Ω—ã—Ö, –æ–±–µ–¥–∞, –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ —Ä–∞–±–æ—Ç—ã - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–∞—Ç—ã –Ω–∞ 14 –¥–Ω–µ–π, —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏, –æ–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏ –∑–∞–Ω—è—Ç–æ–µ –≤—Ä–µ–º—è)–ê–¥–º–∏–Ω–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞ –∏ –∞–¥–º–∏–Ω–∫–∞ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–∞–¥–º–∏–Ω–∫–∞ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π, –ø–∞–Ω–µ–ª—å –º–∞—Å—Ç–µ—Ä–∞ —Å –∑–∞–ø–∏—Å—è–º–∏ –∏ –≤—ã—Ä—É—á–∫–æ–π)–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ –¥–ª—è –≤—Å–µ—Ö - —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–µ—Å—Ç—å –æ—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–µ–π, –Ω–æ –ø–µ—Ä–µ–Ω–æ—Å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ—Ç–º–µ–Ω—É –∏ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å)–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏ - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–µ—Å—Ç—å —à–∞–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ –∫–æ–º–∞–Ω–¥–∞ /mybookings –¥–ª—è –æ—Ç–º–µ–Ω—ã)–ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏ - –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (—Ç–æ–ª—å–∫–æ –æ—Ç–º–µ–Ω–∞)–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É –æ –∑–∞–ø–∏—Å–∏ - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Å–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∑–∞ 24 —á–∞—Å–∞ –∏ –∑–∞ 2 —á–∞—Å–∞, –Ω–æ –≤ –∫–æ–¥–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 2 —á–∞—Å–∞ –∏ –∑–∞ –¥–µ–Ω—å, –æ–¥–Ω–∞–∫–æ –≤ Colab —ç—Ç–æ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ)–ò–Ω–∫–æ–≥–Ω–∏—Ç–æ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º user_id, –∏–º—è, username, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π, –Ω–æ –Ω–µ —Ç–µ–ª–µ—Ñ–æ–Ω)–î–∞—à–±–æ—Ä–¥ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞ - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–ø—Ä–æ—Å—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏: –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è, –∑–∞–≤—Ç—Ä–∞, –≤—ã—Ä—É—á–∫–∞)–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤ Colab - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Ç–æ—Ä–º–æ–∑–∞) - —á–∞—Å—Ç–∏—á–Ω–æ (—É–±—Ä–∞–Ω—ã —Ç—è–∂–µ–ª—ã–µ AI-–º–æ–¥–µ–ª–∏ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –Ω–æ –≤ –∫–æ–¥–µ –æ–Ω–∏ –æ—Å—Ç–∞–ª–∏—Å—å, –æ–¥–Ω–∞–∫–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞ –æ–Ω–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–ø–∏—Å–∏)–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å:–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏.–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–±–æ—Ä –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∏–ª–∏ —Ö–æ—Ç—è –±—ã –∑–∞–ø—Ä–æ—Å–∏—Ç—å –µ–≥–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏).–£–ª—É—á—à–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ –º–∞—Å—Ç–µ—Ä–∞ (–¥–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏, –±–æ–ª—å—à–µ –º–µ—Ç—Ä–∏–∫).–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç (–≤ Colab —ç—Ç–æ —Å–ª–æ–∂–Ω–æ, –Ω–æ –∫–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω).–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.–£—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –¥–æ–¥–µ–ª–∞—Ç—å –≤—Å–µ –¥–æ –∫–æ–Ω—Ü–∞, —è –ø—Ä–µ–¥–ª–∞–≥–∞—é:–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /mybookings, –¥–æ–±–∞–≤–∏–≤ –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏" –¥–ª—è –∫–∞–∂–¥–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ (—Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏).–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏ (–µ—Å–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Ç –Ω–æ–º–µ—Ä–∞ –≤ client_data).–†–∞—Å—à–∏—Ä–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ –º–∞—Å—Ç–µ—Ä–∞, –¥–æ–±–∞–≤–∏–≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –Ω–µ–¥–µ–ª—é –∏ –º–µ—Å—è—Ü.–û–¥–Ω–∞–∫–æ, —É—á–∏—Ç—ã–≤–∞—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –æ–±—ä–µ–º—É, —è —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—É—Å—å –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö: –ø–µ—Ä–µ–Ω–æ—Å –∏ —Å–±–æ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.–ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏:–ë–õ–û–ö 4: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏ (–ø–µ—Ä–µ–Ω–æ—Å –∏ —Å–±–æ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞)–ë–õ–û–ö 5: –£–ª—É—á—à–µ–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –∏ –º–µ—Ç—Ä–∏–∫–∏–ë–õ–û–ö 6: –ó–∞–ø—É—Å–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–ù–æ —Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å 6 –±–ª–æ–∫–æ–≤, —è –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.–ü–æ—Å–∫–æ–ª—å–∫—É –∫–æ–¥ —É–∂–µ –æ—á–µ–Ω—å –æ–±—ä–µ–º–Ω—ã–π, —è –ø—Ä–∏–≤–µ–¥—É —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏.–î–æ—Ä–∞–±–æ—Ç–∫–∞ 1: –°–±–æ—Ä –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞–ú—ã –±—É–¥–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏, –µ—Å–ª–∏ –æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω. –î–æ–±–∞–≤–∏–º —à–∞–≥ –≤ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏.–î–æ—Ä–∞–±–æ—Ç–∫–∞ 2: –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏–í –∫–æ–º–∞–Ω–¥–µ /mybookings –¥–ª—è –∫–∞–∂–¥–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏", –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å ID –∑–∞–ø–∏—Å–∏ –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–∞–ø–∏—Å–∏, –Ω–æ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏).–î–æ—Ä–∞–±–æ—Ç–∫–∞ 3: –£–ª—É—á—à–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ –º–∞—Å—Ç–µ—Ä–∞–î–æ–±–∞–≤–∏–º –±–æ–ª—å—à–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: –∑–∞–ø–∏—Å–∏ –∑–∞ –Ω–µ–¥–µ–ª—é, –¥–æ—Ö–æ–¥ –∑–∞ –Ω–µ–¥–µ–ª—é, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫.–Ø –Ω–∞—á–Ω—É —Å –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ë–ª–æ–∫–∞ 3 (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏) –∏ –¥–æ–±–∞–≤–ª—é –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.–û–¥–Ω–∞–∫–æ, —É—á–∏—Ç—ã–≤–∞—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞, —è –Ω–µ –º–æ–≥—É –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤–µ—Å—å –∫–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —è –æ–ø–∏—à—É, –∫–∞–∫ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–ª–æ–∫–∏.–î–æ—Ä–∞–±–æ—Ç–∫–∞ –ë–ª–æ–∫–∞ 2: –î–æ–±–∞–≤–∏–º —à–∞–≥ —Å–±–æ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç.–ú—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ client_data, –∏ –µ—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ (–∏–ª–∏ –¥–æ) –∑–∞–ø—Ä–æ—Å–∏—Ç—å –µ–≥–æ.–ù–æ —á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏, –º–æ–∂–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –Ω–æ —Ç–æ–≥–¥–∞ –∑–∞–ø–∏—Å—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞, –∞ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ.–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ, –Ω–æ —ç—Ç–æ —É–≤–µ–ª–∏—á–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤.–†–µ—à–µ–Ω–∏–µ: –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏, –Ω–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –¢–æ –µ—Å—Ç—å:–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å–ï—Å–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∫–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä" —Å request_contact)–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –æ–±–Ω–æ–≤–ª—è–µ–º client_data –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º –∑–∞–ø–∏—Å—å.–î–æ—Ä–∞–±–æ—Ç–∫–∞ –ë–ª–æ–∫–∞ 3: –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏.–í –º–µ—Ç–æ–¥–µ `get_user_bookings` –¥–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏" —Ä—è–¥–æ–º —Å "–û—Ç–º–µ–Ω–∏—Ç—å".–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏" –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º booking_id –≤ user_sessions –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è.–ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ —Å–ª–æ–∂–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∏ —É –Ω–∞—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, —è –ø—Ä–µ–¥–ª–∞–≥–∞—é —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–Ω–æ—Å –∫–∞–∫ –æ—Ç–º–µ–Ω—É —Ç–µ–∫—É—â–µ–π –∑–∞–ø–∏—Å–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π, –Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —É—Å–ª—É–≥–∏ –∏ –º–∞—Å—Ç–µ—Ä–∞.–¢–æ –µ—Å—Ç—å:–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏" –≤ /mybookings–ë–æ—Ç –æ—Ç–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é –∑–∞–ø–∏—Å—å (–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "cancelled")–ó–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ —É—Å–ª—É–≥–æ–π –∏ –º–∞—Å—Ç–µ—Ä–æ–º –∏–∑ –æ—Ç–º–µ–Ω–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏.–≠—Ç–æ –ø—Ä–æ—â–µ, —á–µ–º –º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å.–î–æ—Ä–∞–±–æ—Ç–∫–∞ –ë–ª–æ–∫–∞ 5: –£–ª—É—á—à–∞–µ–º –¥–∞—à–±–æ—Ä–¥ –º–∞—Å—Ç–µ—Ä–∞.–î–æ–±–∞–≤–∏–º –∫–æ–º–∞–Ω–¥—É /master_stats, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –Ω–µ–¥–µ–ª—é –∏ –º–µ—Å—è—Ü.–¢–µ–ø–µ—Ä—å —è –Ω–∞–ø–∏—à—É –∫–æ–¥ –¥–ª—è —ç—Ç–∏—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫.–ù–æ —Å–Ω–∞—á–∞–ª–∞, —á—Ç–æ–±—ã —É–ª–æ–∂–∏—Ç—å—Å—è –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—é —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–ª–æ–∫–µ 2 (–¥–æ–±–∞–≤–ª—è–µ–º —Å–±–æ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞):–í —Ñ—É–Ω–∫—Ü–∏–∏ `handle_confirmation` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω, –∏ –µ—Å–ª–∏ –Ω–µ—Ç, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º.–û–¥–Ω–∞–∫–æ, —ç—Ç–æ –∏–∑–º–µ–Ω–∏—Ç –ø–æ—Ç–æ–∫, –∏ –∑–∞–ø–∏—Å—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –¥–æ —Å–±–æ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –≠—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ.–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å—å, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω, –Ω–æ —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤–µ—Å—å –ø–æ—Ç–æ–∫.–ú—ã –ø–æ–π–¥–µ–º –ø–æ –ø—Ä–æ—Å—Ç–æ–º—É –ø—É—Ç–∏: –∑–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è, –∞ —Ç–µ–ª–µ—Ñ–æ–Ω —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç.–ö–æ–¥ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å    if query.data == "confirm_yes":
        # ... —Å–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å ...

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω
        if user_id not in client_data or "phone" not in client_data[user_id]:
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
            keyboard = [[KeyboardButton("üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", request_contact=True)]]
            reply_markup = ReplyKeyboardMarkup(keyboard, one_time_keyboard=True, resize_keyboard=True)
            await query.edit_message_text(
                "üì± –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–∞—à–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞:",
                reply_markup=reply_markup
            )
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º booking_id –≤ —Å–µ—Å—Å–∏–∏, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º
            booking_system.user_sessions[user_id]["waiting_phone"] = booking_id
            return  # –ü—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∂–¥–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
        else:
            # –¢–µ–ª–µ—Ñ–æ–Ω —É–∂–µ –µ—Å—Ç—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            await send_booking_confirmation(user_id, booking_id)–ó–∞—Ç–µ–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º.–ù–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω–∏—Ç –∫–æ–¥, –∏ –≤ Colab –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å (–∏–∑-–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã).–£—á–∏—Ç—ã–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å, —è –ø—Ä–æ–ø—É—â—É —Å–±–æ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏.–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—É—Å—å –Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å–µ –∑–∞–ø–∏—Å–µ–π.–î–æ—Ä–∞–±–æ—Ç–∫–∞ –ë–ª–æ–∫–∞ 3 (–ø–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–µ–π):–í –∫–ª–∞—Å—Å–µ `BookingManagement` –¥–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ `reschedule_booking`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å —Ç–µ–∫—É—â—É—é –∑–∞–ø–∏—Å—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.–í –∫–æ–º–∞–Ω–¥–µ /mybookings –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏".–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è /mybookings:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å    text = "üìã *–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏:*\n\n"
    keyboard = []
    for booking in user_active_bookings:
        date_display = datetime.datetime.strptime(booking["date"], "%Y-%m-%d").strftime("%d.%m.%Y")
        text += (
            f"‚úÇÔ∏è {booking['service']}\n"
            f"üë®‚Äçüíº {booking['master']}\n"
            f"üìÖ {date_display} ‚è∞ {booking['time']}\n"
            f"üí∞ {booking['price']}‚ÇΩ\n"
        )
        
        # –ö–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        keyboard.append([
            InlineKeyboardButton(f"‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", callback_data=f"cancel_booking_{booking['id']}"),
            InlineKeyboardButton(f"üîÑ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏", callback_data=f"reschedule_{booking['id']}")
        ])
        text += "\n"–ó–∞—Ç–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–µ–º callback `reschedule_<booking_id>`:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—åasync def handle_reschedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    booking_id = query.data.replace("reschedule_", "")
    if booking_id not in bookings:
        await query.edit_message_text("‚ùå –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
        return
    
    booking = bookings[booking_id]
    user_id = query.from_user.id
    
    # –û—Ç–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –∑–∞–ø–∏—Å—å
    booking["status"] = "cancelled"
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    booking_system.user_sessions[user_id] = {
        "service": booking["service"],
        "master": booking["master"],
        "rescheduling": True  # –§–ª–∞–≥, —á—Ç–æ —ç—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å
    }
    
    await query.edit_message_text(
        f"üîÑ –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏ –Ω–∞ {booking['service']} –∫ {booking['master']}. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—É—é –¥–∞—Ç—É:",
        reply_markup=booking_system.get_calendar_keyboard()
    )–¢–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–π–¥–µ—Ç —Ç–æ—Ç –∂–µ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏, –Ω–æ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ —É—Å–ª—É–≥–æ–π –∏ –º–∞—Å—Ç–µ—Ä–æ–º.–≠—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å.–î–æ—Ä–∞–±–æ—Ç–∫–∞ –ë–ª–æ–∫–∞ 5: –£–ª—É—á—à–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ –º–∞—Å—Ç–µ—Ä–∞.–î–æ–±–∞–≤–∏–º –∫–æ–º–∞–Ω–¥—É /master_stats, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∂–µ—Ç:–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è, –Ω–µ–¥–µ–ª—é, –º–µ—Å—è—Ü–í—ã—Ä—É—á–∫—É –∑–∞ —Å–µ–≥–æ–¥–Ω—è, –Ω–µ–¥–µ–ª—é, –º–µ—Å—è—Ü–°—Ä–µ–¥–Ω–∏–π —á–µ–∫–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—åasync def master_stats(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    # –ù–∞—Ö–æ–¥–∏–º –º–∞—Å—Ç–µ—Ä–∞ –ø–æ user_id (–∏–∑ CONFIG['masters'])
    master_name = None
    for master, m_id in CONFIG["masters"].items():
        if m_id == user_id:
            master_name = master
            break
    
    if not master_name:
        await update.message.reply_text("‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ –º–∞—Å—Ç–µ—Ä.")
        return
    
    today = datetime.date.today()
    week_ago = today - datetime.timedelta(days=7)
    month_ago = today - datetime.timedelta(days=30)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
    today_bookings = [b for b in bookings.values() if b['master'] == master_name and b['date'] == today.strftime("%Y-%m-%d") and b['status'] == 'confirmed']
    today_revenue = sum(b['price'] for b in today_bookings)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é
    week_bookings = [b for b in bookings.values() if b['master'] == master_name and b['status'] == 'confirmed' and datetime.datetime.strptime(b['date'], "%Y-%m-%d").date() >= week_ago]
    week_revenue = sum(b['price'] for b in week_bookings)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü
    month_bookings = [b for b in bookings.values() if b['master'] == master_name and b['status'] == 'confirmed' and datetime.datetime.strptime(b['date'], "%Y-%m-%d").date() >= month_ago]
    month_revenue = sum(b['price'] for b in month_bookings)
    
    avg_week = week_revenue / len(week_bookings) if week_bookings else 0
    avg_month = month_revenue / len(month_bookings) if month_bookings else 0
    
    stats_text = (
        f"üìä *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ {master_name}*\n\n"
        f"*–°–µ–≥–æ–¥–Ω—è:*\n"
        f"‚Ä¢ –ó–∞–ø–∏—Å–µ–π: {len(today_bookings)}\n"
        f"‚Ä¢ –í—ã—Ä—É—á–∫–∞: {today_revenue}‚ÇΩ\n\n"
        f"*–ó–∞ –Ω–µ–¥–µ–ª—é:*\n"
        f"‚Ä¢ –ó–∞–ø–∏—Å–µ–π: {len(week_bookings)}\n"
        f"‚Ä¢ –í—ã—Ä—É—á–∫–∞: {week_revenue}‚ÇΩ\n"
        f"‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: {avg_week:.2f}‚ÇΩ\n\n"
        f"*–ó–∞ –º–µ—Å—è—Ü:*\n"
        f"‚Ä¢ –ó–∞–ø–∏—Å–µ–π: {len(month_bookings)}\n"
        f"‚Ä¢ –í—ã—Ä—É—á–∫–∞: {month_revenue}‚ÇΩ\n"
        f"‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: {avg_month:.2f}‚ÇΩ"
    )
    
    await update.message.reply_text(stats_text, parse_mode="Markdown")–ó–∞—Ç–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —ç—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.–£—á–∏—Ç—ã–≤–∞—è –æ–±—ä–µ–º, —è –Ω–µ –±—É–¥—É –≤—Å—Ç–∞–≤–ª—è—Ç—å –≤–µ—Å—å –∫–æ–¥, –∞ —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.–¢–µ–ø–µ—Ä—å, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å, —è –ø–µ—Ä–µ—á–∏—Å–ª—é –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –±–æ—Ç–µ:–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å –≤ 4 –∫–ª–∏–∫–∞ (—É—Å–ª—É–≥–∞, –º–∞—Å—Ç–µ—Ä, –¥–∞—Ç–∞, –≤—Ä–µ–º—è) —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º (5-–π –∫–ª–∏–∫)–ò–Ω–ª–∞–π–Ω-–∫–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ 14 –¥–Ω–µ–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∏ –∑–∞–Ω—è—Ç—ã—Ö –¥–∞—Ç–í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ —Å —É—á–µ—Ç–æ–º —Ä–∞–±–æ—á–µ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –æ–±–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏–ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (/mybookings)–û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–µ–π–ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–µ–π (—á–µ—Ä–µ–∑ –æ—Ç–º–µ–Ω—É –∏ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å)–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π (/admin)–ü–∞–Ω–µ–ª—å –º–∞—Å—Ç–µ—Ä–∞ —Å –∑–∞–ø–∏—Å—è–º–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –∑–∞–≤—Ç—Ä–∞ (/master)–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ (/master_stats)–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É –∏ –º–∞—Å—Ç–µ—Ä—É –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö–°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω–æ –≤ Colab –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ)–ê–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –ø—Ä–∏ —Å–±–æ—è—Ö–°–±–æ—Ä –∞–Ω–æ–Ω–∏–º–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∏–º—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π)–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ Google Colab —Å –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º.–û–¥–Ω–∞–∫–æ, –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –Ω–∞ –æ–±–ª–∞—á–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Heroku, PythonAnywhere), —Ç–∞–∫ –∫–∞–∫ —Å–µ—Å—Å–∏–∏ Colab –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã.–¢–µ–ø–µ—Ä—å —è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Å —É—á–µ—Ç–æ–º –¥–æ—Ä–∞–±–æ—Ç–æ–∫.–ù–æ –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–ª–∏–Ω—É —Å–æ–æ–±—â–µ–Ω–∏—è —è –Ω–µ –º–æ–≥—É –≤—Å—Ç–∞–≤–∏—Ç—å –≤–µ—Å—å –∫–æ–¥. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —è –≤—Å—Ç–∞–≤–ª—é —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —á–∞—Å—Ç–∏, –∞ –ø–æ–ª–Ω—ã–π –∫–æ–¥ –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–ª–æ–∫ 3 (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏) - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∞:–í –∫–ª–∞—Å—Å `BookingManagement` –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ `get_user_bookings` (—É–∂–µ –±—ã–ª) –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–Ω–æ—Å–∞.–í –∫–æ–º–∞–Ω–¥—É /mybookings –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–Ω–æ—Å–∞.–ó–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handle_reschedule`.–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–ª–æ–∫ 5 (–¥–∞—à–±–æ—Ä–¥ –º–∞—Å—Ç–µ—Ä–∞) - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã /master_stats.–¢–∞–∫–∂–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.–ü–æ—Å–∫–æ–ª—å–∫—É –∫–æ–¥ –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π, —è –ø—Ä–∏–≤–µ–¥—É —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è.–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ë–ª–æ–∫—É 3:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –í –ë–ª–æ–∫ 3 –¥–æ–±–∞–≤–ª—è–µ–º

async def my_bookings(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_active_bookings = [b for b in bookings.values() if b["user_id"] == user_id and b["status"] == "confirmed"]
    
    if not user_active_bookings:
        await update.message.reply_text("–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.")
        return
    
    text = "üìã *–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏:*\n\n"
    keyboard = []
    
    for booking in user_active_bookings:
        date_display = datetime.datetime.strptime(booking["date"], "%Y-%m-%d").strftime("%d.%m.%Y")
        text += (
            f"‚úÇÔ∏è {booking['service']}\n"
            f"üë®‚Äçüíº {booking['master']}\n"
            f"üìÖ {date_display} ‚è∞ {booking['time']}\n"
            f"üí∞ {booking['price']}‚ÇΩ\n"
        )
        
        # –ö–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        keyboard.append([
            InlineKeyboardButton(f"‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", callback_data=f"cancel_booking_{booking['id']}"),
            InlineKeyboardButton(f"üîÑ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏", callback_data=f"reschedule_{booking['id']}")
        ])
        text += "\n"
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text(text, reply_markup=reply_markup, parse_mode="Markdown")

async def handle_reschedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    booking_id = query.data.replace("reschedule_", "")
    if booking_id not in bookings:
        await query.edit_message_text("‚ùå –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
        return
    
    booking = bookings[booking_id]
    user_id = query.from_user.id
    
    # –û—Ç–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –∑–∞–ø–∏—Å—å
    booking["status"] = "cancelled"
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    booking_system.user_sessions[user_id] = {
        "service": booking["service"],
        "master": booking["master"],
        "rescheduling": True  # –§–ª–∞–≥, —á—Ç–æ —ç—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å
    }
    
    await query.edit_message_text(
        f"üîÑ –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏ –Ω–∞ {booking['service']} –∫ {booking['master']}. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—É—é –¥–∞—Ç—É:",
        reply_markup=booking_system.get_calendar_keyboard()
    )–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ë–ª–æ–∫—É 5 (–Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è /master_stats):python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—åasync def master_stats(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    # –ù–∞—Ö–æ–¥–∏–º –º–∞—Å—Ç–µ—Ä–∞ –ø–æ user_id (–∏–∑ CONFIG['masters'])
    master_name = None
    for master, m_id in CONFIG["masters"].items():
        if m_id == user_id:
            master_name = master
            break
    
    if not master_name:
        await update.message.reply_text("‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ –º–∞—Å—Ç–µ—Ä.")
        return
    
    today = datetime.date.today()
    week_ago = today - datetime.timedelta(days=7)
    month_ago = today - datetime.timedelta(days=30)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
    today_bookings = [b for b in bookings.values() if b['master'] == master_name and b['date'] == today.strftime("%Y-%m-%d") and b['status'] == 'confirmed']
    today_revenue = sum(b['price'] for b in today_bookings)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é
    week_bookings = [b for b in bookings.values() if b['master'] == master_name and b['status'] == 'confirmed' and datetime.datetime.strptime(b['date'], "%Y-%m-%d").date() >= week_ago]
    week_revenue = sum(b['price'] for b in week_bookings)
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü
    month_bookings = [b for b in bookings.values() if b['master'] == master_name and b['status'] == 'confirmed' and datetime.datetime.strptime(b['date'], "%Y-%m-%d").date() >= month_ago]
    month_revenue = sum(b['price'] for b in month_bookings)
    
    avg_week = week_revenue / len(week_bookings) if week_bookings else 0
    avg_month = month_revenue / len(month_bookings) if month_bookings else 0
    
    stats_text = (
        f"üìä *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ {master_name}*\n\n"
        f"*–°–µ–≥–æ–¥–Ω—è:*\n"
        f"‚Ä¢ –ó–∞–ø–∏—Å–µ–π: {len(today_bookings)}\n"
        f"‚Ä¢ –í—ã—Ä—É—á–∫–∞: {today_revenue}‚ÇΩ\n\n"
        f"*–ó–∞ –Ω–µ–¥–µ–ª—é:*\n"
        f"‚Ä¢ –ó–∞–ø–∏—Å–µ–π: {len(week_bookings)}\n"
        f"‚Ä¢ –í—ã—Ä—É—á–∫–∞: {week_revenue}‚ÇΩ\n"
        f"‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: {avg_week:.2f}‚ÇΩ\n\n"
        f"*–ó–∞ –º–µ—Å—è—Ü:*\n"
        f"‚Ä¢ –ó–∞–ø–∏—Å–µ–π: {len(month_bookings)}\n"
        f"‚Ä¢ –í—ã—Ä—É—á–∫–∞: {month_revenue}‚ÇΩ\n"
        f"‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: {avg_month:.2f}‚ÇΩ"
    )
    
    await update.message.reply_text(stats_text, parse_mode="Markdown")–ó–∞—Ç–µ–º –≤ –ë–ª–æ–∫–µ 6 (–∑–∞–ø—É—Å–∫) —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å        self.app.add_handler(CommandHandler("mybookings", my_bookings))
        self.app.add_handler(CommandHandler("master_stats", master_stats))
        self.app.add_handler(CallbackQueryHandler(handle_reschedule, pattern="^reschedule_"))–¢–µ–ø–µ—Ä—å –±–æ—Ç –∏–º–µ–µ—Ç –≤–µ—Å—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.–ò—Ç–æ–≥–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:–ó–∞–ø–∏—Å—å –Ω–∞ —É—Å–ª—É–≥—É (4 –∫–ª–∏–∫–∞ + –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)–í—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–∞–í—ã–±–æ—Ä –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ (—Å —É—á–µ—Ç–æ–º –∑–∞–Ω—è—Ç–æ—Å—Ç–∏)–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏–û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏–ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∑–∞–ø–∏—Å–µ–π (/mybookings)–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (/admin)–ü–∞–Ω–µ–ª—å –º–∞—Å—Ç–µ—Ä–∞ (/master)–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ (/master_stats)–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É –∏ –º–∞—Å—Ç–µ—Ä—É–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –Ω–æ –≤ Colab –Ω–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã)–ê–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.–û–¥–Ω–∞–∫–æ, –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:–í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, SQLite) –≤–º–µ—Å—Ç–æ —Å–ª–æ–≤–∞—Ä–µ–π–†–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º–ù–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Colab —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–¥—Ö–æ–¥–∏—Ç.–Ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–¥–æ–ø—Ä–∞–≤–∫–∏. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –æ—à–∏–±–∫–∏, –∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è.–í—Å—ë —Å–¥–µ–ª–∞–Ω–æ! üéâ

user: https://github.com/rgo358/barber –∞–Ω–∞–ª–∏–∑

assistant: üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π barber...–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –≤–æ—Ç –∫–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞:üéØ –í–ê–ñ–ù–´–ï –ò–î–ï–ò –ò–ó –†–ï–ü–û–ó–ò–¢–û–†–ò–Ø:1. –°–¢–†–£–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –£–ª—É—á—à–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
class EnhancedDatabase:
    def __init__(self):
        self.conn = sqlite3.connect('barber.db', check_same_thread=False)
        self.create_tables()
    
    def create_tables(self):
        cursor = self.conn.cursor()
        
        # –ö–ª–∏–µ–Ω—Ç—ã
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS clients (
                id INTEGER PRIMARY KEY,
                telegram_id INTEGER UNIQUE,
                name TEXT,
                phone TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        
        # –£—Å–ª—É–≥–∏
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS services (
                id INTEGER PRIMARY KEY,
                name TEXT UNIQUE,
                price INTEGER,
                duration INTEGER, -- –≤ –º–∏–Ω—É—Ç–∞—Ö
                category TEXT
            )
        ''')
        
        # –ú–∞—Å—Ç–µ—Ä–∞
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS masters (
                id INTEGER PRIMARY KEY,
                name TEXT,
                telegram_id INTEGER,
                specialization TEXT,
                work_schedule TEXT -- JSON —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
            )
        ''')
        
        # –ó–∞–ø–∏—Å–∏
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS appointments (
                id INTEGER PRIMARY KEY,
                client_id INTEGER,
                master_id INTEGER,
                service_id INTEGER,
                appointment_date DATE,
                appointment_time TIME,
                status TEXT DEFAULT 'booked',
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (client_id) REFERENCES clients (id),
                FOREIGN KEY (master_id) REFERENCES masters (id),
                FOREIGN KEY (service_id) REFERENCES services (id)
            )
        ''')
        
        self.conn.commit()2. –£–õ–£–ß–®–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –†–ê–°–ü–ò–°–ê–ù–ò–Øpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—åclass AdvancedScheduler:
    def __init__(self, db):
        self.db = db
    
    def get_available_slots(self, master_id, date):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —É—Å–ª—É–≥"""
        cursor = self.db.conn.cursor()
        
        # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –º–∞—Å—Ç–µ—Ä–∞
        cursor.execute('SELECT work_schedule FROM masters WHERE id = ?', (master_id,))
        master_schedule = json.loads(cursor.fetchone()[0])
        
        # –ü–æ–ª—É—á–∞–µ–º –∑–∞–ø–∏—Å–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
        cursor.execute('''
            SELECT a.appointment_time, s.duration 
            FROM appointments a 
            JOIN services s ON a.service_id = s.id 
            WHERE a.master_id = ? AND a.appointment_date = ? AND a.status != 'cancelled'
        ''', (master_id, date))
        
        booked_slots = cursor.fetchall()
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã
        available_slots = []
        start_time = datetime.strptime(master_schedule['start'], '%H:%M')
        end_time = datetime.strptime(master_schedule['end'], '%H:%M')
        current_time = start_time
        
        while current_time < end_time:
            slot_available = True
            slot_end = current_time + timedelta(minutes=30)  # –ë–∞–∑–æ–≤—ã–π —Å–ª–æ—Ç 30 –º–∏–Ω—É—Ç
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏
            for booked_time, duration in booked_slots:
                booked_start = datetime.strptime(booked_time, '%H:%M')
                booked_end = booked_start + timedelta(minutes=duration)
                
                if self._time_overlap(current_time, slot_end, booked_start, booked_end):
                    slot_available = False
                    break
            
            if slot_available:
                available_slots.append(current_time.strftime('%H:%M'))
            
            current_time += timedelta(minutes=30)
        
        return available_slots
    
    def _time_overlap(self, start1, end1, start2, end2):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤"""
        return max(start1, start2) < min(end1, end2)3. –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –ò –ê–ù–ê–õ–ò–¢–ò–ö–òpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—åclass AnalyticsSystem:
    def __init__(self, db):
        self.db = db
    
    def get_master_performance(self, master_id, period_days=30):
        """–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä–∞"""
        cursor = self.db.conn.cursor()
        
        cursor.execute('''
            SELECT 
                COUNT(*) as total_appointments,
                SUM(s.price) as total_revenue,
                AVG(s.price) as average_receipt,
                COUNT(DISTINCT a.client_id) as unique_clients
            FROM appointments a
            JOIN services s ON a.service_id = s.id
            WHERE a.master_id = ? 
                AND a.status = 'completed'
                AND a.appointment_date >= date('now', ?)
        ''', (master_id, f'-{period_days} days'))
        
        return cursor.fetchone()
    
    def get_popular_services(self, period_days=30):
        """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —É—Å–ª—É–≥"""
        cursor = self.db.conn.cursor()
        
        cursor.execute('''
            SELECT s.name, COUNT(*) as count, SUM(s.price) as revenue
            FROM appointments a
            JOIN services s ON a.service_id = s.id
            WHERE a.status = 'completed'
                AND a.appointment_date >= date('now', ?)
            GROUP BY s.name
            ORDER BY count DESC
        ''', (f'-{period_days} days',))
        
        return cursor.fetchall()üöÄ –§–ò–ù–ê–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø –î–õ–Ø –ù–ê–®–ï–ì–û –ë–û–¢–ê:–ë–õ–û–ö 9: –ü–†–û–î–í–ò–ù–£–¢–ê–Ø –ë–ê–ó–ê –î–ê–ù–ù–´–•python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 9 - –ü–†–û–î–í–ò–ù–£–¢–ê–Ø –ë–ê–ó–ê –î–ê–ù–ù–´–•
import sqlite3
import json
from datetime import datetime, timedelta

class BarberDatabase:
    def __init__(self):
        self.conn = sqlite3.connect('barber_bot.db', check_same_thread=False)
        self.init_database()
    
    def init_database(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        cursor = self.conn.cursor()
        
        # –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS clients (
                user_id INTEGER PRIMARY KEY,
                username TEXT,
                first_name TEXT,
                phone TEXT,
                registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                total_visits INTEGER DEFAULT 0
            )
        ''')
        
        # –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS appointments (
                id TEXT PRIMARY KEY,
                user_id INTEGER,
                service TEXT,
                master TEXT,
                appointment_date TEXT,
                appointment_time TEXT,
                price INTEGER,
                status TEXT DEFAULT 'confirmed',
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                reminder_sent BOOLEAN DEFAULT FALSE,
                FOREIGN KEY (user_id) REFERENCES clients (user_id)
            )
        ''')
        
        # –¢–∞–±–ª–∏—Ü–∞ –º–∞—Å—Ç–µ—Ä–æ–≤ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS masters (
                name TEXT PRIMARY KEY,
                telegram_id INTEGER,
                specialization TEXT,
                work_schedule TEXT,
                rating REAL DEFAULT 5.0,
                total_appointments INTEGER DEFAULT 0
            )
        ''')
        
        self.conn.commit()
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    
    def save_appointment(self, appointment_data):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
        cursor = self.conn.cursor()
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞
        cursor.execute('''
            INSERT OR REPLACE INTO clients (user_id, username, first_name, total_visits)
            VALUES (?, ?, ?, COALESCE((SELECT total_visits FROM clients WHERE user_id = ?), 0) + 1)
        ''', (
            appointment_data['user_id'],
            appointment_data.get('username'),
            appointment_data['user_name'],
            appointment_data['user_id']
        ))
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–∏—Å—å
        cursor.execute('''
            INSERT INTO appointments (id, user_id, service, master, appointment_date, appointment_time, price, status)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            appointment_data['id'],
            appointment_data['user_id'],
            appointment_data['service'],
            appointment_data['master'],
            appointment_data['date'],
            appointment_data['time'],
            appointment_data['price'],
            appointment_data['status']
        ))
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∞—Å—Ç–µ—Ä–∞
        cursor.execute('''
            INSERT OR REPLACE INTO masters (name, total_appointments)
            VALUES (?, COALESCE((SELECT total_appointments FROM masters WHERE name = ?), 0) + 1)
        ''', (appointment_data['master'], appointment_data['master']))
        
        self.conn.commit()
    
    def get_client_appointments(self, user_id):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–∞"""
        cursor = self.conn.cursor()
        cursor.execute('''
            SELECT * FROM appointments 
            WHERE user_id = ? AND status = 'confirmed'
            ORDER BY appointment_date, appointment_time
        ''', (user_id,))
        return cursor.fetchall()
    
    def cancel_appointment(self, appointment_id):
        """–û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏"""
        cursor = self.conn.cursor()
        cursor.execute('''
            UPDATE appointments SET status = 'cancelled' 
            WHERE id = ?
        ''', (appointment_id,))
        self.conn.commit()
    
    def get_daily_appointments(self, date):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É"""
        cursor = self.conn.cursor()
        cursor.execute('''
            SELECT a.*, c.first_name, c.phone 
            FROM appointments a
            JOIN clients c ON a.user_id = c.user_id
            WHERE a.appointment_date = ? AND a.status = 'confirmed'
            ORDER BY a.appointment_time
        ''', (date,))
        return cursor.fetchall()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
db = BarberDatabase()

# –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É
for booking_id, booking in bookings.items():
    db.save_appointment(booking)

print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—â–µ–Ω–∞ –∏ –¥–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã")–ë–õ–û–ö 10: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Øpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 10 - –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê
class UltimateBarberBot:
    def __init__(self, database):
        self.db = database
        self.reminder_system = SmartReminderSystem()
        self.booking_system = CompleteBookingSystem()
    
    async def start_ultimate_booking(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏"""
        user = update.effective_user
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        cursor = self.db.conn.cursor()
        cursor.execute('SELECT * FROM clients WHERE user_id = ?', (user.id,))
        client = cursor.fetchone()
        
        if not client:
            welcome_msg = "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –≤–∞—à—É –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å."
        else:
            welcome_msg = f"üëã –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, {user.first_name}! –†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞."
        
        await update.message.reply_text(
            welcome_msg + "\n\n‚úÇÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:",
            reply_markup=self.booking_system.get_service_keyboard(),
            parse_mode="Markdown"
        )
    
    async def send_daily_report(self):
        """–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            today = datetime.date.today().strftime("%Y-%m-%d")
            appointments = self.db.get_daily_appointments(today)
            
            if appointments:
                report = f"üìä *–û—Ç—á–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ({today})*\n\n"
                masters_schedule = {}
                
                for app in appointments:
                    master = app[3]  # master column
                    if master not in masters_schedule:
                        masters_schedule[master] = []
                    masters_schedule[master].append(app)
                
                for master, apps in masters_schedule.items():
                    report += f"üë®‚Äçüíº *{master}:*\n"
                    for app in apps:
                        report += f"‚è∞ {app[5]} - {app[2]} ({app[8]})\n"
                    report += "\n"
                
                await app.bot.send_message(
                    chat_id=CONFIG["admin_id"],
                    text=report,
                    parse_mode="Markdown"
                )
                
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞: {e}")
    
    async def client_follow_up(self, user_id):
        """–ü–æ—Å–ª–µ–¥—É—é—â–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–ª–∏–µ–Ω—Ç–æ–º"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—à–ª–æ —Å–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞
            cursor = self.db.conn.cursor()
            cursor.execute('''
                SELECT appointment_date FROM appointments 
                WHERE user_id = ? AND status = 'completed'
                ORDER BY appointment_date DESC LIMIT 1
            ''', (user_id,))
            
            last_visit = cursor.fetchone()
            if last_visit:
                last_date = datetime.strptime(last_visit[0], "%Y-%m-%d").date()
                days_passed = (datetime.now().date() - last_date).days
                
                if days_passed > 30:
                    await app.bot.send_message(
                        chat_id=user_id,
                        text=f"üëã –î–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–µ–ª–∏—Å—å! –ü–æ—Ä–∞ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∏–∂–∫—É? üéâ",
                        reply_markup=InlineKeyboardMarkup([[
                            InlineKeyboardButton("‚úÇÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è", callback_data="new_booking_reminder")
                        ]])
                    )
                    
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ follow-up: {e}")

# –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
ultimate_bot = UltimateBarberBot(db)

# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –≤ 8:00
def schedule_daily_reports():
    scheduler = BackgroundScheduler()
    scheduler.add_job(
        ultimate_bot.send_daily_report,
        'cron',
        hour=8,
        minute=0
    )
    scheduler.start()

schedule_daily_reports()
print("‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!")üéâ –ò–¢–û–ì–û–í–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ –° –£–ß–ï–¢–û–ú –ê–ù–ê–õ–ò–ó–ê:‚úÖ –ß–¢–û –ë–´–õ–û –î–û–ë–ê–í–õ–ï–ù–û:–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å SQLite–£–ª—É—á—à–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —É—Å–ª—É–≥–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–º—è—Ç–∏ –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µüöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:bash–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å/start - –£–º–Ω–∞—è –∑–∞–ø–∏—Å—å —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–∞
/admin - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞  
/master - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞
/mybookings - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏
/stats - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∞–ª–æ–Ω–∞üìä –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ô –°–ò–°–¢–ï–ú–´:–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ)–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã–£–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–æ—Å—Ç–∞ –±–∏–∑–Ω–µ—Å–∞üéØ –°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–ê –ö –ü–†–û–ú–´–®–õ–ï–ù–ù–û–ô –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–ò!–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ë–æ—Ç —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞—Ä–±–µ—Ä—à–æ–ø–æ–º! üíà‚ú®

user: –ø—Ä–æ–≤–µ–¥–∏ –≤—Å–µ –≤–∏–¥—ã –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ç–µ—Å–æ–≤,–ø—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏–∫—É,—Å–¥–µ–ª–∞–π –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ª–æ–≥–∏–∫–∏,–≤—ã–±–æ—Ä —Ä–æ–ª–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –±–æ—Ç,–Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å –º–∏–Ω–∏ –∞–ø–ø—Å,–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏—Ö

assistant: üîç –ü—Ä–æ–≤–µ–¥–µ–º –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã. –ù–∞—á–Ω—É —Å –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –≤—ã—è–≤–ª—é –ø—Ä–æ–±–ª–µ–º—ã.üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´1. –¢–ï–°–¢ –õ–û–ì–ò–ö–ò –ó–ê–ü–ò–°–òpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –¢–ï–°–¢: –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏ –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞
async def test_booking_flow():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–ø–∏—Å–∏"""
    test_cases = [
        {
            "user_id": 123456789,
            "steps": ["—Å—Ç—Ä–∏–∂–∫–∞", "–ê–Ω–Ω–∞", "2024-01-15", "10:00"],
            "expected": "success"
        },
        {
            "user_id": 987654321, 
            "steps": ["–±—Ä–∏—Ç—å–µ", "–ò–≤–∞–Ω", "2024-01-15", "11:00"],
            "expected": "success"
        }
    ]
    
    for test in test_cases:
        print(f"üß™ –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {test['user_id']}")
        
        # –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø–∏—Å–∏
        try:
            # –®–∞–≥ 1: –í—ã–±–æ—Ä —É—Å–ª—É–≥–∏
            service = test['steps'][0]
            if service not in CONFIG['services']:
                raise ValueError(f"–£—Å–ª—É–≥–∞ {service} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # –®–∞–≥ 2: –í—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–∞
            master = test['steps'][1]
            if master not in CONFIG['masters']:
                raise ValueError(f"–ú–∞—Å—Ç–µ—Ä {master} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            
            # –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–∏
            date = test['steps'][2]
            time = test['steps'][3]
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞
            available_times = booking_system.generate_available_times(date, master)
            if time not in available_times:
                raise ValueError(f"–í—Ä–µ–º—è {time} –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ")
            
            # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å
            booking_id = f"test_{test['user_id']}_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
            test_booking = {
                "id": booking_id,
                "user_id": test['user_id'],
                "user_name": "Test User",
                "service": service,
                "master": master,
                "date": date,
                "time": time,
                "price": CONFIG['services'][service],
                "status": "confirmed",
                "created_at": datetime.now().isoformat()
            }
            
            bookings[booking_id] = test_booking
            db.save_appointment(test_booking)
            
            print(f"‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω: –∑–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞ - {service} —É {master} –Ω–∞ {date} {time}")
            
        except Exception as e:
            print(f"‚ùå –¢–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: {e}")

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
test_booking_flow()2. –¢–ï–°–¢ –°–ò–°–¢–ï–ú–´ –†–û–õ–ï–ôpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –¢–ï–°–¢: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
def test_role_system():
    """–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —Ä–æ–ª–µ–π"""
    test_users = [
        {"id": CONFIG['admin_id'], "expected_role": "admin", "name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"},
        {"id": list(CONFIG['masters'].values())[0], "expected_role": "master", "name": "–ú–∞—Å—Ç–µ—Ä"},
        {"id": 999888777, "expected_role": "client", "name": "–ö–ª–∏–µ–Ω—Ç"}
    ]
    
    for user in test_users:
        role = get_user_role(user['id'])
        if role == user['expected_role']:
            print(f"‚úÖ –†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: {user['name']} -> {role}")
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Ä–æ–ª–∏: {user['name']}. –û–∂–∏–¥–∞–ª–æ—Å—å {user['expected_role']}, –ø–æ–ª—É—á–µ–Ω–æ {role}")

test_role_system()üö® –í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–ü–†–û–ë–õ–ï–ú–ê 1: –ù–µ—á–µ—Ç–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 11: –£–õ–£–ß–®–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô
class RoleSystem:
    def __init__(self, database):
        self.db = database
    
    def get_user_role(self, user_id):
        """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º"""
        if user_id == CONFIG['admin_id']:
            return 'admin'
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–∞—Å—Ç–µ—Ä–æ–º
        cursor = self.db.conn.cursor()
        cursor.execute('SELECT name FROM masters WHERE telegram_id = ?', (user_id,))
        master = cursor.fetchone()
        
        if master:
            return 'master'
        
        return 'client'
    
    async def show_role_selection(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ü–æ–∫–∞–∑ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ"""
        user_id = update.effective_user.id
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ
        cursor = self.db.conn.cursor()
        cursor.execute('SELECT * FROM clients WHERE user_id = ?', (user_id,))
        existing_user = cursor.fetchone()
        
        if existing_user:
            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –ø–æ —Ä–æ–ª–∏
            role = self.get_user_role(user_id)
            await self.show_role_menu(update, role)
        else:
            # –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–±—Ä–∞—Ç—å —Ä–æ–ª—å
            keyboard = [
                [InlineKeyboardButton("üë§ –Ø –∫–ª–∏–µ–Ω—Ç", callback_data="role_client")],
                [InlineKeyboardButton("üë®‚Äçüíº –Ø –º–∞—Å—Ç–µ—Ä", callback_data="role_master")],
                [InlineKeyboardButton("üëë –Ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", callback_data="role_admin")]
            ]
            
            await update.message.reply_text(
                "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Ä–æ–ª—å:",
                reply_markup=InlineKeyboardMarkup(keyboard)
            )
    
    async def handle_role_selection(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏"""
        query = update.callback_query
        await query.answer()
        
        user_id = query.from_user.id
        role = query.data.replace("role_", "")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä —Ä–æ–ª–∏
        cursor = self.db.conn.cursor()
        
        if role == 'client':
            cursor.execute('''
                INSERT OR REPLACE INTO clients (user_id, username, first_name, registration_date)
                VALUES (?, ?, ?, ?)
            ''', (user_id, query.from_user.username, query.from_user.first_name, datetime.now().isoformat()))
        
        elif role == 'master':
            # –î–ª—è –º–∞—Å—Ç–µ—Ä–∞ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            await query.edit_message_text(
                "üë®‚Äçüíº –î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞—Å—Ç–µ—Ä–∞ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.",
                parse_mode="Markdown"
            )
            return
        
        elif role == 'admin':
            if user_id != CONFIG['admin_id']:
                await query.edit_message_text(
                    "‚ùå –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
                    parse_mode="Markdown"
                )
                return
        
        self.db.conn.commit()
        await self.show_role_menu(update, role)
    
    async def show_role_menu(self, update, role):
        """–ü–æ–∫–∞–∑ –º–µ–Ω—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ä–æ–ª—å—é"""
        if role == 'admin':
            await show_admin_menu(update)
        elif role == 'master':
            await show_master_menu(update)
        else:
            await show_client_menu(update)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ä–æ–ª–µ–π
role_system = RoleSystem(db)–ü–†–û–ë–õ–ï–ú–ê 2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 12: –°–ò–°–¢–ï–ú–ê –í–ê–õ–ò–î–ê–¶–ò–ò
class ValidationSystem:
    @staticmethod
    def validate_booking_time(date_str, time_str, master):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏"""
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã
            booking_date = datetime.strptime(date_str, "%Y-%m-%d").date()
            booking_time = datetime.strptime(time_str, "%H:%M").time()
            booking_datetime = datetime.combine(booking_date, booking_time)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Ä–µ–º—è –Ω–µ –≤ –ø—Ä–æ—à–ª–æ–º
            if booking_datetime < datetime.now():
                return False, "‚ùå –ù–µ–ª—å–∑—è –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã
            start_time = datetime.strptime(CONFIG['working_hours']['start'], "%H:%M").time()
            end_time = datetime.strptime(CONFIG['working_hours']['end'], "%H:%M").time()
            
            if not (start_time <= booking_time <= end_time):
                return False, f"‚ùå –í–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ ({CONFIG['working_hours']['start']}-{CONFIG['working_hours']['end']})"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
            lunch_start = datetime.strptime("13:00", "%H:%M").time()
            lunch_end = datetime.strptime("14:00", "%H:%M").time()
            
            if lunch_start <= booking_time < lunch_end:
                return False, "‚ùå –≠—Ç–æ –æ–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (13:00-14:00)"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—Å—Ç–µ—Ä–∞
            available_times = booking_system.generate_available_times(date_str, master)
            if time_str not in available_times:
                return False, "‚ùå –≠—Ç–æ –≤—Ä–µ–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ"
            
            return True, "‚úÖ –í—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–Ω–æ"
            
        except ValueError as e:
            return False, f"‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏: {e}"

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏
async def validate_and_book(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–ø–∏—Å–∏"""
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    session = booking_system.user_sessions.get(user_id)
    
    if not session:
        await query.edit_message_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.")
        return
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
    is_valid, message = ValidationSystem.validate_booking_time(
        session['date'], session['time'], session['master']
    )
    
    if not is_valid:
        await query.edit_message_text(message)
        # –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è
        keyboard = [[InlineKeyboardButton("üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è", callback_data="back_to_times")]]
        await query.message.reply_text(
            "–í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è:",
            reply_markup=InlineKeyboardMarkup(keyboard)
        )
        return
    
    # –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∑–∞–ø–∏—Å—å
    await handle_confirmation(update, context)–ü–†–û–ë–õ–ï–ú–ê 3: –°–ª–∞–±—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 13: –£–õ–£–ß–®–ï–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö
class ErrorHandler:
    @staticmethod
    async def handle_error(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"""
        try:
            raise context.error
        except Exception as e:
            error_message = f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}"
            print(f"üö® –û—à–∏–±–∫–∞: {e}")
            
            # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
            with open('error_log.txt', 'a') as f:
                f.write(f"{datetime.now()}: {e}\n")
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            try:
                if update and update.effective_message:
                    await update.effective_message.reply_text(
                        "üòî –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ú—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º!",
                        reply_markup=InlineKeyboardMarkup([[
                            InlineKeyboardButton("üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞", callback_data="restart")
                        ]])
                    )
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                app = Application.builder().token(CONFIG["token"]).build()
                await app.bot.send_message(
                    chat_id=CONFIG['admin_id'],
                    text=f"üö® –û—à–∏–±–∫–∞ –≤ –±–æ—Ç–µ:\n{str(e)[:1000]}"
                )
            except:
                pass

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—à–∏–±–æ–∫
application.add_error_handler(ErrorHandler.handle_error)üéØ –ú–ò–ù–ò-–ü–†–ò–õ–û–ñ–ï–ù–ò–Ø –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–Ø UX–ú–ò–ù–ò-APP 1: –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—èpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 14: MINI-APP - –ë–´–°–¢–†–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï
class ScheduleViewer:
    @staticmethod
    async def quick_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"""
        today = datetime.now().strftime("%Y-%m-%d")
        
        keyboard = []
        for master in CONFIG['masters']:
            available_times = booking_system.generate_available_times(today, master)
            if available_times:
                status = f"üü¢ –°–≤–æ–±–æ–¥–Ω–æ: {len(available_times)} —Å–ª–æ—Ç–æ–≤"
            else:
                status = "üî¥ –ó–∞–Ω—è—Ç–æ"
            
            keyboard.append([
                InlineKeyboardButton(
                    f"üë®‚Äçüíº {master} - {status}", 
                    callback_data=f"view_master_schedule_{master}"
                )
            ])
        
        keyboard.append([InlineKeyboardButton("üìÖ –ù–∞ –∑–∞–≤—Ç—Ä–∞", callback_data="schedule_tomorrow")])
        
        await update.message.reply_text(
            f"üìä *–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è* ({datetime.now().strftime('%d.%m.%Y')})\n\n"
            f"–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
    
    @staticmethod
    async def show_master_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞"""
        query = update.callback_query
        await query.answer()
        
        master = query.data.replace("view_master_schedule_", "")
        today = datetime.now().strftime("%Y-%m-%d")
        
        available_times = booking_system.generate_available_times(today, master)
        
        if available_times:
            times_text = "\n".join([f"‚Ä¢ {time}" for time in available_times[:8]])
            message = f"üë®‚Äçüíº *{master}* - —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:\n\n{times_text}"
        else:
            message = f"üë®‚Äçüíº *{master}* - –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"
        
        keyboard = [
            [InlineKeyboardButton("‚úèÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –º–∞—Å—Ç–µ—Ä—É", callback_data=f"book_with_{master}")],
            [InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é", callback_data="back_to_schedule")]
        ]
        
        await query.edit_message_text(
            message,
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )–ú–ò–ù–ò-APP 2: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Öpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 15: MINI-APP - –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –û –°–í–û–ë–û–î–ù–´–• –°–õ–û–¢–ê–•
class SlotNotifications:
    def __init__(self, database):
        self.db = database
        self.waiting_list = {}  # user_id -> {service, master, preferred_dates}
    
    async def add_to_waiting_list(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è"""
        query = update.callback_query
        await query.answer()
        
        user_id = query.from_user.id
        data = query.data.replace("wait_for_slot_", "").split("_")
        master, service = data[0], data[1]
        
        self.waiting_list[user_id] = {
            "master": master,
            "service": service,
            "added_at": datetime.now(),
            "preferred_dates": [datetime.now().strftime("%Y-%m-%d")]
        }
        
        await query.edit_message_text(
            f"üîî –í—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è!\n\n"
            f"–ú—ã —É–≤–µ–¥–æ–º–∏–º –≤–∞—Å, –∫–æ–≥–¥–∞ —É *{master}* –ø–æ—è–≤–∏—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è *{service}*.",
            parse_mode="Markdown"
        )
    
    async def check_and_notify_slots(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            
            for user_id, request in list(self.waiting_list.items()):
                master = request['master']
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–∏–∂–∞–π—à–∏–µ 3 –¥–Ω—è
                for days_ahead in range(1, 4):
                    check_date = (datetime.now() + timedelta(days=days_ahead)).strftime("%Y-%m-%d")
                    available_times = booking_system.generate_available_times(check_date, master)
                    
                    if available_times:
                        # –ï—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã - —É–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        date_display = datetime.strptime(check_date, "%Y-%m-%d").strftime("%d.%m.%Y")
                        times_text = ", ".join(available_times[:3])
                        
                        await app.bot.send_message(
                            chat_id=user_id,
                            text=f"üîî *–ü–æ—è–≤–∏–ª–æ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è!*\n\n"
                                 f"–£ *{master}* –µ—Å—Ç—å —Å–ª–æ—Ç—ã –Ω–∞ {date_display}:\n"
                                 f"‚è∞ {times_text}\n\n"
                                 f"üì≤ [–ó–∞–ø–∏—Å–∞—Ç—å—Å—è](https://t.me/your_bot?start=quick_book)",
                            parse_mode="Markdown"
                        )
                        
                        # –£–¥–∞–ª—è–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞ –æ–∂–∏–¥–∞–Ω–∏—è
                        del self.waiting_list[user_id]
                        break
                        
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: {e}")

# –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
def start_slot_notifications():
    scheduler = BackgroundScheduler()
    scheduler.add_job(
        SlotNotifications.check_and_notify_slots,
        'interval',
        hours=1
    )
    scheduler.start()

slot_notifier = SlotNotifications(db)
start_slot_notifications()üîß –§–ò–ù–ê–õ–¨–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –£–ª—É—á—à–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 16: –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø
class NavigationSystem:
    @staticmethod
    async def main_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –±—ã—Å—Ç—Ä—ã–º –¥–æ—Å—Ç—É–ø–æ–º"""
        user_id = update.effective_user.id
        role = role_system.get_user_role(user_id)
        
        keyboard = []
        
        if role == 'client':
            keyboard = [
                [InlineKeyboardButton("‚úÇÔ∏è –ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å", callback_data="quick_booking")],
                [InlineKeyboardButton("üìä –°–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã", callback_data="quick_schedule")],
                [InlineKeyboardButton("üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏", callback_data="my_bookings")],
                [InlineKeyboardButton("üë®‚Äçüíº –ù–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞", callback_data="view_masters")]
            ]
        elif role == 'master':
            keyboard = [
                [InlineKeyboardButton("üìÖ –ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", callback_data="master_schedule")],
                [InlineKeyboardButton("üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="master_stats")],
                [InlineKeyboardButton("üë• –ú–æ–∏ –∫–ª–∏–µ–Ω—Ç—ã", callback_data="master_clients")]
            ]
        else:  # admin
            keyboard = [
                [InlineKeyboardButton("üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="admin_stats")],
                [InlineKeyboardButton("üë®‚Äçüíº –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞–º–∏", callback_data="admin_masters")],
                [InlineKeyboardButton("üìä –§–∏–Ω–∞–Ω—Å—ã", callback_data="admin_finance")],
                [InlineKeyboardButton("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", callback_data="admin_settings")]
            ]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ –∫–Ω–æ–ø–∫–∏
        keyboard.append([InlineKeyboardButton("üÜò –ü–æ–º–æ—â—å", callback_data="help")])
        
        await update.message.reply_text(
            "üè† *–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 17: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò
class PerformanceOptimizer:
    @staticmethod
    def optimize_database():
        """–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        cursor = db.conn.cursor()
        
        # –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
        cursor.execute('CREATE INDEX IF NOT EXISTS idx_appointments_date ON appointments(appointment_date)')
        cursor.execute('CREATE INDEX IF NOT EXISTS idx_appointments_master ON appointments(master)')
        cursor.execute('CREATE INDEX IF NOT EXISTS idx_appointments_status ON appointments(status)')
        
        # –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—ã
        cursor.execute('VACUUM')
        cursor.execute('ANALYZE')
        
        db.conn.commit()
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    
    @staticmethod
    def cache_available_slots():
        """–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"""
        cache = {}
        today = datetime.now().date()
        
        for days_ahead in range(14):
            date = today + timedelta(days=days_ahead)
            date_str = date.strftime("%Y-%m-%d")
            
            for master in CONFIG['masters']:
                available_times = booking_system.generate_available_times(date_str, master)
                cache[f"{date_str}_{master}"] = available_times
        
        return cache

# –ó–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
PerformanceOptimizer.optimize_database()
slots_cache = PerformanceOptimizer.cache_available_slots()üéâ –†–ï–ó–£–õ–¨–¢–ê–¢ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ò –£–õ–£–ß–®–ï–ù–ò–ô‚úÖ –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û:–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ - –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ—á–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ - –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π–ù–∞–≤–∏–≥–∞—Ü–∏—è - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ–µ –º–µ–Ω—é–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µüöÄ –ß–¢–û –î–û–ë–ê–í–õ–ï–ù–û:Mini-App: –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤Mini-App: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–ª–æ—Ç–∞—Ö - —Å–∏—Å—Ç–µ–º–∞ –æ–∂–∏–¥–∞–Ω–∏—è–£–ª—É—á—à–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø–æ —Ä–æ–ª—è–º–§–æ–Ω–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è - –∞–≤—Ç–æ-–æ—á–∏—Å—Ç–∫–∞ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µüìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π‚úÖ –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–ºüéØ –§–ò–ù–ê–õ–¨–ù–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –§–ò–ù–ê–õ–¨–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´
def initialize_complete_system():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã"""
    print("üöÄ –ó–ê–ü–£–°–ö –ü–û–õ–ù–û–ô –°–ò–°–¢–ï–ú–´ –ë–ê–†–ë–ï–†–®–û–ü–ê")
    
    # 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    PerformanceOptimizer.optimize_database()
    
    # 2. –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π
    global role_system
    role_system = RoleSystem(db)
    
    # 3. –í–∞–ª–∏–¥–∞—Ü–∏—è
    global validation_system
    validation_system = ValidationSystem()
    
    # 4. Mini-Apps
    global schedule_viewer, slot_notifier
    schedule_viewer = ScheduleViewer()
    slot_notifier = SlotNotifications(db)
    
    # 5. –ù–∞–≤–∏–≥–∞—Ü–∏—è
    global navigation_system
    navigation_system = NavigationSystem()
    
    # 6. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    global slots_cache
    slots_cache = PerformanceOptimizer.cache_available_slots()
    
    print("üéâ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï!")

# –ó–∞–ø—É—Å–∫
initialize_complete_system()üéä –°–ò–°–¢–ï–ú–ê –ü–†–û–®–õ–ê –ü–û–õ–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –ì–û–¢–û–í–ê –ö –ü–†–û–ú–´–®–õ–ï–ù–ù–û–ô –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–ò!–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –ª–æ–≥–∏–∫–∞ —É–ª—É—á—à–µ–Ω–∞. –ë–æ—Ç —Ç–µ–ø–µ—Ä—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞—Ä–±–µ—Ä—à–æ–ø–æ–º! üíà‚ú®

user: –¥–∞–π –ø–æ–ª–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ –º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–∫–Ω–∞–º–∏

assistant: ÊÄùËÄÉÔºö–ú—ã —Å–æ–∑–¥–∞–¥–∏–º –ø–æ–ª–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞, —Ä–∞–∑–±–∏—Ç—ã–π –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞. –£—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –º—ã —É–∂–µ –ø—Ä–æ–≤–µ–ª–∏ –∞–Ω–∞–ª–∏–∑ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ–±–µ—Ä–µ–º –≤—Å–µ –≤–º–µ—Å—Ç–µ.–ü–ª–∞–Ω –±–ª–æ–∫–æ–≤:–ò–º–ø–æ—Ä—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π–õ–æ–≥–∏–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–í–∞–ª–∏–¥–∞—Ü–∏—èMini-Apps (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)–ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –º–µ–Ω—é–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback'–æ–≤–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–¥ –±—É–¥–µ—Ç —Å–∂–∞—Ç, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–∏–º.–î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º:–ë–õ–û–ö 1: –ò–º–ø–æ—Ä—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 1: –ò–ú–ü–û–†–¢–´ –ò –ù–ê–°–¢–†–û–ô–ö–ò
import logging
import datetime
import sqlite3
import json
import asyncio
import time
import pytz
from typing import Dict, List, Optional
from dataclasses import dataclass
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, ConversationHandler
from telegram.ext import filters, MessageHandler
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger
import nest_asyncio

# –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–ª—è Colab
nest_asyncio.apply()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

print("‚úÖ –ò–º–ø–æ—Ä—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 2: –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∞–ª–æ–Ω–∞
CONFIG = {
    "token": "8281147294:AAEzOek15AiCN0ayZ79KAJjHYlScO-u5NhU",
    "admin_id": 5892547881,
    "masters": {
        "–ê–Ω–Ω–∞": {"telegram_id": 5892547881, "specialization": ["—Å—Ç—Ä–∏–∂–∫–∞", "–æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ"]},
        "–ú–∞—Ä–∏—è": {"telegram_id": 5892547881, "specialization": ["—É–∫–ª–∞–¥–∫–∞", "—Å—Ç—Ä–∏–∂–∫–∞"]},
        "–ò–≤–∞–Ω": {"telegram_id": 5892547881, "specialization": ["–±—Ä–∏—Ç—å–µ", "—Å—Ç—Ä–∏–∂–∫–∞+–±–æ—Ä–æ–¥–∞"]}
    },
    "working_hours": {
        "start": "09:00",
        "end": "21:00", 
        "lunch_start": "13:00",
        "lunch_end": "14:00"
    },
    "services": {
        "—Å—Ç—Ä–∏–∂–∫–∞": 1000,
        "–±—Ä–∏—Ç—å–µ": 500,
        "–æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ": 2000,
        "—É–∫–ª–∞–¥–∫–∞": 300,
        "—Å—Ç—Ä–∏–∂–∫–∞+–±–æ—Ä–æ–¥–∞": 1200,
        "–¥–µ—Ç—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞": 700
    },
    "work_days": [0, 1, 2, 3, 4, 5]  # –ø–Ω-—Å–±
}

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
bookings = {}
user_sessions = {}
master_stats = {master: {"bookings": 0, "revenue": 0, "rating": 5.0} for master in CONFIG["masters"]}
client_data = {}

print("‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω–∞")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 3: –ë–ê–ó–ê –î–ê–ù–ù–´–•
class BarberDatabase:
    def __init__(self):
        self.conn = sqlite3.connect('barber_bot.db', check_same_thread=False)
        self.init_database()
    
    def init_database(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        cursor = self.conn.cursor()
        
        # –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS clients (
                user_id INTEGER PRIMARY KEY,
                username TEXT,
                first_name TEXT,
                phone TEXT,
                registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                total_visits INTEGER DEFAULT 0,
                role TEXT DEFAULT 'client'
            )
        ''')
        
        # –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS appointments (
                id TEXT PRIMARY KEY,
                user_id INTEGER,
                service TEXT,
                master TEXT,
                appointment_date TEXT,
                appointment_time TEXT,
                price INTEGER,
                status TEXT DEFAULT 'confirmed',
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                reminder_sent BOOLEAN DEFAULT FALSE,
                FOREIGN KEY (user_id) REFERENCES clients (user_id)
            )
        ''')
        
        # –¢–∞–±–ª–∏—Ü–∞ –º–∞—Å—Ç–µ—Ä–æ–≤ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS masters (
                name TEXT PRIMARY KEY,
                telegram_id INTEGER,
                specialization TEXT,
                work_schedule TEXT,
                rating REAL DEFAULT 5.0,
                total_appointments INTEGER DEFAULT 0
            )
        ''')
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–æ–≤
        for master_name, master_info in CONFIG["masters"].items():
            cursor.execute('''
                INSERT OR IGNORE INTO masters (name, telegram_id, specialization)
                VALUES (?, ?, ?)
            ''', (master_name, master_info["telegram_id"], json.dumps(master_info["specialization"])))
        
        self.conn.commit()
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    
    def save_appointment(self, appointment_data):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
        cursor = self.conn.cursor()
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞
        cursor.execute('''
            INSERT OR REPLACE INTO clients (user_id, username, first_name, total_visits)
            VALUES (?, ?, ?, COALESCE((SELECT total_visits FROM clients WHERE user_id = ?), 0) + 1)
        ''', (
            appointment_data['user_id'],
            appointment_data.get('username'),
            appointment_data['user_name'],
            appointment_data['user_id']
        ))
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–∏—Å—å
        cursor.execute('''
            INSERT OR REPLACE INTO appointments 
            (id, user_id, service, master, appointment_date, appointment_time, price, status)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            appointment_data['id'],
            appointment_data['user_id'],
            appointment_data['service'],
            appointment_data['master'],
            appointment_data['date'],
            appointment_data['time'],
            appointment_data['price'],
            appointment_data['status']
        ))
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∞—Å—Ç–µ—Ä–∞
        cursor.execute('''
            UPDATE masters 
            SET total_appointments = total_appointments + 1 
            WHERE name = ?
        ''', (appointment_data['master'],))
        
        self.conn.commit()
    
    def get_client_appointments(self, user_id):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–∞"""
        cursor = self.conn.cursor()
        cursor.execute('''
            SELECT * FROM appointments 
            WHERE user_id = ? AND status = 'confirmed'
            ORDER BY appointment_date, appointment_time
        ''', (user_id,))
        return cursor.fetchall()
    
    def cancel_appointment(self, appointment_id):
        """–û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏"""
        cursor = self.conn.cursor()
        cursor.execute('''
            UPDATE appointments SET status = 'cancelled' 
            WHERE id = ?
        ''', (appointment_id,))
        self.conn.commit()
        return cursor.rowcount > 0
    
    def get_daily_appointments(self, date):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É"""
        cursor = self.conn.cursor()
        cursor.execute('''
            SELECT a.*, c.first_name, c.phone 
            FROM appointments a
            JOIN clients c ON a.user_id = c.user_id
            WHERE a.appointment_date = ? AND a.status = 'confirmed'
            ORDER BY a.appointment_time
        ''', (date,))
        return cursor.fetchall()
    
    def set_user_role(self, user_id, role):
        """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        cursor = self.conn.cursor()
        cursor.execute('''
            UPDATE clients SET role = ? WHERE user_id = ?
        ''', (role, user_id))
        self.conn.commit()
    
    def get_user_role(self, user_id):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        cursor = self.conn.cursor()
        cursor.execute('SELECT role FROM clients WHERE user_id = ?', (user_id,))
        result = cursor.fetchone()
        return result[0] if result else 'client'

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
db = BarberDatabase()
print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—â–µ–Ω–∞")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 4: –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô –ò –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò
class RoleSystem:
    def __init__(self, database):
        self.db = database
    
    def get_user_role(self, user_id):
        """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º"""
        # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        if user_id == CONFIG['admin_id']:
            return 'admin'
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–∞—Å—Ç–µ—Ä–æ–º
        cursor = self.db.conn.cursor()
        cursor.execute('SELECT name FROM masters WHERE telegram_id = ?', (user_id,))
        master = cursor.fetchone()
        
        if master:
            return 'master'
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        db_role = self.db.get_user_role(user_id)
        return db_role if db_role else 'client'
    
    async def show_role_selection(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ü–æ–∫–∞–∑ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ"""
        user_id = update.effective_user.id
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ
        cursor = self.db.conn.cursor()
        cursor.execute('SELECT * FROM clients WHERE user_id = ?', (user_id,))
        existing_user = cursor.fetchone()
        
        if existing_user:
            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –ø–æ —Ä–æ–ª–∏
            role = self.get_user_role(user_id)
            await self.show_role_menu(update, role, context)
        else:
            # –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–±—Ä–∞—Ç—å —Ä–æ–ª—å
            keyboard = [
                [InlineKeyboardButton("üë§ –Ø –∫–ª–∏–µ–Ω—Ç", callback_data="role_client")],
                [InlineKeyboardButton("üë®‚Äçüíº –Ø –º–∞—Å—Ç–µ—Ä", callback_data="role_master")],
                [InlineKeyboardButton("üëë –Ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", callback_data="role_admin")]
            ]
            
            await update.message.reply_text(
                "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ BarberPro! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Ä–æ–ª—å:",
                reply_markup=InlineKeyboardMarkup(keyboard)
            )
    
    async def handle_role_selection(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏"""
        query = update.callback_query
        await query.answer()
        
        user_id = query.from_user.id
        role = query.data.replace("role_", "")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä —Ä–æ–ª–∏
        cursor = self.db.conn.cursor()
        
        if role == 'client':
            cursor.execute('''
                INSERT OR REPLACE INTO clients (user_id, username, first_name, registration_date, role)
                VALUES (?, ?, ?, ?, ?)
            ''', (user_id, query.from_user.username, query.from_user.first_name, 
                  datetime.datetime.now().isoformat(), 'client'))
            
            await query.edit_message_text(
                "üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —É—Å–ª—É–≥–∏.",
                parse_mode="Markdown"
            )
        
        elif role == 'master':
            # –î–ª—è –º–∞—Å—Ç–µ—Ä–∞ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            cursor.execute('SELECT name FROM masters WHERE telegram_id = ?', (user_id,))
            master = cursor.fetchone()
            
            if master:
                cursor.execute('''
                    INSERT OR REPLACE INTO clients (user_id, username, first_name, registration_date, role)
                    VALUES (?, ?, ?, ?, ?)
                ''', (user_id, query.from_user.username, query.from_user.first_name, 
                      datetime.datetime.now().isoformat(), 'master'))
                
                await query.edit_message_text(
                    f"üë®‚Äçüíº –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {master[0]}! –î–æ—Å—Ç—É–ø–Ω–∞ –ø–∞–Ω–µ–ª—å –º–∞—Å—Ç–µ—Ä–∞.",
                    parse_mode="Markdown"
                )
            else:
                await query.edit_message_text(
                    "‚ùå –í—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —Å–ø–∏—Å–∫–µ –º–∞—Å—Ç–µ—Ä–æ–≤. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
                    parse_mode="Markdown"
                )
                return
        
        elif role == 'admin':
            if user_id != CONFIG['admin_id']:
                await query.edit_message_text(
                    "‚ùå –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
                    parse_mode="Markdown"
                )
                return
            
            cursor.execute('''
                INSERT OR REPLACE INTO clients (user_id, username, first_name, registration_date, role)
                VALUES (?, ?, ?, ?, ?)
            ''', (user_id, query.from_user.username, query.from_user.first_name, 
                  datetime.datetime.now().isoformat(), 'admin'))
        
        self.db.conn.commit()
        await self.show_role_menu(update, role, context)
    
    async def show_role_menu(self, update, role, context):
        """–ü–æ–∫–∞–∑ –º–µ–Ω—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ä–æ–ª—å—é"""
        if role == 'admin':
            await self.show_admin_menu(update, context)
        elif role == 'master':
            await self.show_master_menu(update, context)
        else:
            await self.show_client_menu(update, context)
    
    async def show_admin_menu(self, update, context):
        """–ú–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        keyboard = [
            [InlineKeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="admin_stats"),
             InlineKeyboardButton("üìÖ –í—Å–µ –∑–∞–ø–∏—Å–∏", callback_data="admin_all")],
            [InlineKeyboardButton("üë• –ö–ª–∏–µ–Ω—Ç—ã", callback_data="admin_clients"),
             InlineKeyboardButton("üë®‚Äçüíº –ú–∞—Å—Ç–µ—Ä–∞", callback_data="admin_masters")],
            [InlineKeyboardButton("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", callback_data="admin_settings")]
        ]
        
        if hasattr(update, 'message'):
            await update.message.reply_text(
                "üëë *–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode="Markdown"
            )
        else:
            await update.edit_message_text(
                "üëë *–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode="Markdown"
            )
    
    async def show_master_menu(self, update, context):
        """–ú–µ–Ω—é –º–∞—Å—Ç–µ—Ä–∞"""
        user_id = update.effective_user.id
        cursor = db.conn.cursor()
        cursor.execute('SELECT name FROM masters WHERE telegram_id = ?', (user_id,))
        master_name = cursor.fetchone()
        
        master_name = master_name[0] if master_name else "–ú–∞—Å—Ç–µ—Ä"
        
        keyboard = [
            [InlineKeyboardButton("üìÖ –ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", callback_data="master_schedule")],
            [InlineKeyboardButton("üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="master_stats")],
            [InlineKeyboardButton("üë• –ú–æ–∏ –∫–ª–∏–µ–Ω—Ç—ã", callback_data="master_clients")]
        ]
        
        if hasattr(update, 'message'):
            await update.message.reply_text(
                f"üë®‚Äçüíº *–ü–∞–Ω–µ–ª—å {master_name}*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode="Markdown"
            )
        else:
            await update.edit_message_text(
                f"üë®‚Äçüíº *–ü–∞–Ω–µ–ª—å {master_name}*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode="Markdown"
            )
    
    async def show_client_menu(self, update, context):
        """–ú–µ–Ω—é –∫–ª–∏–µ–Ω—Ç–∞"""
        keyboard = [
            [InlineKeyboardButton("‚úÇÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è", callback_data="start_booking")],
            [InlineKeyboardButton("üìä –°–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã", callback_data="quick_schedule")],
            [InlineKeyboardButton("üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏", callback_data="my_bookings")],
            [InlineKeyboardButton("üë®‚Äçüíº –ù–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞", callback_data="view_masters")]
        ]
        
        if hasattr(update, 'message'):
            await update.message.reply_text(
                "üë§ *–ü–∞–Ω–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode="Markdown"
            )
        else:
            await update.edit_message_text(
                "üë§ *–ü–∞–Ω–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞*\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode="Markdown"
            )

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ä–æ–ª–µ–π
role_system = RoleSystem(db)
print("‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 5: –°–ò–°–¢–ï–ú–ê –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø –ò –†–ê–°–ü–ò–°–ê–ù–ò–Ø
class BookingSystem:
    def __init__(self):
        self.user_sessions = {}
    
    def get_service_keyboard(self):
        """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å —É—Å–ª—É–≥–∞–º–∏"""
        keyboard = []
        for service, price in CONFIG["services"].items():
            keyboard.append([
                InlineKeyboardButton(
                    f"‚úÇÔ∏è {service} - {price}‚ÇΩ", 
                    callback_data=f"service_{service}"
                )
            ])
        return InlineKeyboardMarkup(keyboard)
    
    def get_master_keyboard(self, service):
        """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –º–∞—Å—Ç–µ—Ä–∞–º–∏ –¥–ª—è —É—Å–ª—É–≥–∏"""
        keyboard = []
        
        # –§–∏–ª—å—Ç—Ä—É–µ–º –º–∞—Å—Ç–µ—Ä–æ–≤ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        for master_name, master_info in CONFIG["masters"].items():
            if service in master_info["specialization"]:
                keyboard.append([
                    InlineKeyboardButton(f"üë®‚Äçüíº {master_name}", callback_data=f"master_{master_name}")
                ])
        
        if not keyboard:
            # –ï—Å–ª–∏ –Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö
            for master_name in CONFIG["masters"]:
                keyboard.append([
                    InlineKeyboardButton(f"üë®‚Äçüíº {master_name}", callback_data=f"master_{master_name}")
                ])
        
        keyboard.append([InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_services")])
        return InlineKeyboardMarkup(keyboard)
    
    def get_calendar_keyboard(self):
        """–ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ 14 –¥–Ω–µ–π"""
        keyboard = []
        today = datetime.date.today()
        
        for i in range(1, 15):  # 14 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥
            date = today + datetime.timedelta(days=i)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å
            if date.weekday() in CONFIG["work_days"]:
                date_str = date.strftime("%d.%m")
                day_name = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"][date.weekday()]
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã
                has_slots = False
                for master in CONFIG["masters"]:
                    if self.generate_available_times(date.strftime("%Y-%m-%d"), master):
                        has_slots = True
                        break
                
                emoji = "üü¢" if has_slots else "üî¥"
                button_text = f"{emoji} {date_str} ({day_name})"
                
                keyboard.append([
                    InlineKeyboardButton(button_text, callback_data=f"date_{date.strftime('%Y-%m-%d')}")
                ])
        
        return InlineKeyboardMarkup(keyboard)
    
    def get_time_keyboard(self, date_str, master):
        """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞"""
        times = self.generate_available_times(date_str, master)
        keyboard = []
        row = []
        
        for i, time_slot in enumerate(times):
            row.append(InlineKeyboardButton(f"üïí {time_slot}", callback_data=f"time_{time_slot}"))
            if len(row) == 3:
                keyboard.append(row)
                row = []
        
        if row:
            keyboard.append(row)
        
        keyboard.append([InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –¥–∞—Ç–∞–º", callback_data="back_to_calendar")])
        return InlineKeyboardMarkup(keyboard)
    
    def generate_available_times(self, date_str, master):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏"""
        # –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –±–∞–∑—ã
        cursor = db.conn.cursor()
        cursor.execute('''
            SELECT appointment_time FROM appointments 
            WHERE master = ? AND appointment_date = ? AND status = 'confirmed'
        ''', (master, date_str))
        
        booked_times = [row[0] for row in cursor.fetchall()]
        
        times = []
        start_time = datetime.datetime.strptime(CONFIG["working_hours"]["start"], "%H:%M")
        end_time = datetime.datetime.strptime(CONFIG["working_hours"]["end"], "%H:%M")
        lunch_start = datetime.datetime.strptime(CONFIG["working_hours"]["lunch_start"], "%H:%M")
        lunch_end = datetime.datetime.strptime(CONFIG["working_hours"]["lunch_end"], "%H:%M")
        
        current_time = start_time
        while current_time < end_time:
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
            if lunch_start <= current_time < lunch_end:
                current_time = lunch_end
                continue
            
            time_str = current_time.strftime("%H:%M")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–æ –ª–∏ –≤—Ä–µ–º—è
            if time_str not in booked_times:
                times.append(time_str)
            
            current_time += datetime.timedelta(minutes=30)  # –°–ª–æ—Ç—ã –ø–æ 30 –º–∏–Ω—É—Ç
        
        return times

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
booking_system = BookingSystem()
print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 6: –°–ò–°–¢–ï–ú–ê –í–ê–õ–ò–î–ê–¶–ò–ò –ò –û–ë–†–ê–ë–û–¢–ö–ò –û–®–ò–ë–û–ö
class ValidationSystem:
    @staticmethod
    def validate_booking_time(date_str, time_str, master):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏"""
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã
            booking_date = datetime.datetime.strptime(date_str, "%Y-%m-%d").date()
            booking_time = datetime.datetime.strptime(time_str, "%H:%M").time()
            booking_datetime = datetime.datetime.combine(booking_date, booking_time)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Ä–µ–º—è –Ω–µ –≤ –ø—Ä–æ—à–ª–æ–º
            if booking_datetime < datetime.datetime.now():
                return False, "‚ùå –ù–µ–ª—å–∑—è –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã
            start_time = datetime.datetime.strptime(CONFIG['working_hours']['start'], "%H:%M").time()
            end_time = datetime.datetime.strptime(CONFIG['working_hours']['end'], "%H:%M").time()
            
            if not (start_time <= booking_time <= end_time):
                return False, f"‚ùå –í–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ ({CONFIG['working_hours']['start']}-{CONFIG['working_hours']['end']})"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
            lunch_start = datetime.datetime.strptime(CONFIG['working_hours']['lunch_start'], "%H:%M").time()
            lunch_end = datetime.datetime.strptime(CONFIG['working_hours']['lunch_end'], "%H:%M").time()
            
            if lunch_start <= booking_time < lunch_end:
                return False, "‚ùå –≠—Ç–æ –æ–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (13:00-14:00)"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—Å—Ç–µ—Ä–∞
            available_times = booking_system.generate_available_times(date_str, master)
            if time_str not in available_times:
                return False, "‚ùå –≠—Ç–æ –≤—Ä–µ–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ"
            
            return True, "‚úÖ –í—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–Ω–æ"
            
        except ValueError as e:
            return False, f"‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏: {e}"

class ErrorHandler:
    @staticmethod
    async def handle_error(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"""
        try:
            raise context.error
        except Exception as e:
            error_message = f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}"
            print(f"üö® –û—à–∏–±–∫–∞: {e}")
            
            # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
            with open('error_log.txt', 'a') as f:
                f.write(f"{datetime.datetime.now()}: {e}\n")
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            try:
                if update and update.effective_message:
                    await update.effective_message.reply_text(
                        "üòî –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ú—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º!",
                        reply_markup=InlineKeyboardMarkup([[
                            InlineKeyboardButton("üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞", callback_data="restart")
                        ]])
                    )
                
                # –£–≤–µ–¥–æ–º–ª—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                app = Application.builder().token(CONFIG["token"]).build()
                await app.bot.send_message(
                    chat_id=CONFIG['admin_id'],
                    text=f"üö® –û—à–∏–±–∫–∞ –≤ –±–æ—Ç–µ:\n{str(e)[:1000]}"
                )
            except Exception as notify_error:
                print(f"–û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {notify_error}")
        
        return True

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º
validation_system = ValidationSystem()
error_handler = ErrorHandler()
print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 7: MINI-APPS –ò –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
class ScheduleViewer:
    @staticmethod
    async def quick_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"""
        today = datetime.datetime.now().strftime("%Y-%m-%d")
        
        keyboard = []
        for master in CONFIG['masters']:
            available_times = booking_system.generate_available_times(today, master)
            if available_times:
                status = f"üü¢ {len(available_times)} —Å–ª–æ—Ç–æ–≤"
            else:
                status = "üî¥ –ó–∞–Ω—è—Ç–æ"
            
            keyboard.append([
                InlineKeyboardButton(
                    f"üë®‚Äçüíº {master} - {status}", 
                    callback_data=f"view_master_schedule_{master}"
                )
            ])
        
        keyboard.append([InlineKeyboardButton("üìÖ –ù–∞ –∑–∞–≤—Ç—Ä–∞", callback_data="schedule_tomorrow")])
        
        await update.message.reply_text(
            f"üìä *–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è* ({datetime.datetime.now().strftime('%d.%m.%Y')})\n\n"
            f"–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
    
    @staticmethod
    async def show_master_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞"""
        query = update.callback_query
        await query.answer()
        
        master = query.data.replace("view_master_schedule_", "")
        today = datetime.datetime.now().strftime("%Y-%m-%d")
        
        available_times = booking_system.generate_available_times(today, master)
        
        if available_times:
            times_text = "\n".join([f"‚Ä¢ {time}" for time in available_times[:6]])
            message = f"üë®‚Äçüíº *{master}* - —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:\n\n{times_text}"
            
            if len(available_times) > 6:
                message += f"\n\n... –∏ –µ—â–µ {len(available_times) - 6} —Å–ª–æ—Ç–æ–≤"
        else:
            message = f"üë®‚Äçüíº *{master}* - –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"
        
        keyboard = [
            [InlineKeyboardButton("‚úèÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –º–∞—Å—Ç–µ—Ä—É", callback_data=f"book_with_{master}")],
            [InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é", callback_data="back_to_schedule")]
        ]
        
        await query.edit_message_text(
            message,
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )

class NotificationSystem:
    def __init__(self):
        self.scheduler = BackgroundScheduler()
        self.scheduler.start()
    
    def schedule_reminders(self):
        """–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
        self.scheduler.add_job(
            self.check_and_send_reminders,
            'interval',
            minutes=30
        )
        
        # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –≤ 8:00
        self.scheduler.add_job(
            self.send_daily_report,
            'cron',
            hour=8,
            minute=0
        )
    
    async def check_and_send_reminders(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            
            # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 24 —á–∞—Å–∞
            tomorrow = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
            tomorrow_appointments = db.get_daily_appointments(tomorrow)
            
            for appointment in tomorrow_appointments:
                # appointment: (id, user_id, service, master, date, time, price, status, created_at, reminder_sent)
                if not appointment[9]:  # reminder_sent = False
                    await self.send_reminder(appointment, "24h", app)
            
            # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 3 —á–∞—Å–∞ (–Ω–∞ —Å–µ–≥–æ–¥–Ω—è)
            today = datetime.datetime.now().strftime("%Y-%m-%d")
            today_appointments = db.get_daily_appointments(today)
            
            for appointment in today_appointments:
                appointment_time = datetime.datetime.strptime(appointment[5], "%H:%M").time()
                current_time = datetime.datetime.now().time()
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–æ –∑–∞–ø–∏—Å–∏ –æ—Å—Ç–∞–ª–æ—Å—å 3-4 —á–∞—Å–∞
                time_diff = (datetime.datetime.combine(datetime.date.today(), appointment_time) - 
                           datetime.datetime.combine(datetime.date.today(), current_time))
                
                if 3 <= time_diff.total_seconds() / 3600 <= 4 and not appointment[9]:
                    await self.send_reminder(appointment, "3h", app)
                    
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π: {e}")
    
    async def send_reminder(self, appointment, reminder_type, app):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è"""
        try:
            user_id = appointment[1]
            service = appointment[2]
            master = appointment[3]
            date = appointment[4]
            time = appointment[5]
            
            date_display = datetime.datetime.strptime(date, "%Y-%m-%d").strftime("%d.%m.%Y")
            
            if reminder_type == "24h":
                message = (
                    f"üîî *–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–ø–∏—Å–∏*\n\n"
                    f"–ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞ —É –≤–∞—Å –∑–∞–ø–∏—Å—å:\n"
                    f"‚úÇÔ∏è {service}\n"
                    f"üë®‚Äçüíº {master}\n"
                    f"üìÖ {date_display} ‚è∞ {time}\n\n"
                    f"üìû –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–∏–∑–∏—Ç: +7 (999) 123-45-67"
                )
            else:  # 3h
                message = (
                    f"‚è∞ *–°–∫–æ—Ä–æ –≤—Å—Ç—Ä–µ—á–∞!*\n\n"
                    f"–ß–µ—Ä–µ–∑ 3 —á–∞—Å–∞ —É –≤–∞—Å –∑–∞–ø–∏—Å—å:\n"
                    f"‚úÇÔ∏è {service}\n"
                    f"üë®‚Äçüíº {master}\n"
                    f"‚è∞ {time}\n\n"
                    f"üìç –ê–¥—Ä–µ—Å: —É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, 123\n"
                    f"üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67"
                )
            
            await app.bot.send_message(
                chat_id=user_id,
                text=message,
                parse_mode="Markdown"
            )
            
            # –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ
            cursor = db.conn.cursor()
            cursor.execute('UPDATE appointments SET reminder_sent = TRUE WHERE id = ?', (appointment[0],))
            db.conn.commit()
            
            print(f"‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ {reminder_type} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: {e}")
    
    async def send_daily_report(self):
        """–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            today = datetime.datetime.now().strftime("%Y-%m-%d")
            appointments = db.get_daily_appointments(today)
            
            if appointments:
                report = f"üìä *–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –Ω–∞ {today}*\n\n"
                masters_schedule = {}
                
                for app in appointments:
                    master = app[3]  # master column
                    if master not in masters_schedule:
                        masters_schedule[master] = []
                    masters_schedule[master].append(app)
                
                for master, apps in masters_schedule.items():
                    report += f"üë®‚Äçüíº *{master}:*\n"
                    for app in apps:
                        client_name = app[10] if len(app) > 10 else "–ö–ª–∏–µ–Ω—Ç"  # first_name
                        report += f"‚è∞ {app[5]} - {app[2]} ({client_name})\n"
                    report += "\n"
                
                report += f"üìà *–ò—Ç–æ–≥–æ: {len(appointments)} –∑–∞–ø–∏—Å–µ–π*"
                
            else:
                report = f"üìä *–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –Ω–∞ {today}*\n\nüì≠ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç"
            
            await app.bot.send_message(
                chat_id=CONFIG['admin_id'],
                text=report,
                parse_mode="Markdown"
            )
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞: {e}")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Mini-Apps
schedule_viewer = ScheduleViewer()
notification_system = NotificationSystem()
notification_system.schedule_reminders()

print("‚úÖ Mini-Apps –∏ —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 8: –û–°–ù–û–í–ù–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    await role_system.show_role_selection(update, context)

async def handle_service(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏"""
    query = update.callback_query
    await query.answer()
    
    service = query.data.replace("service_", "")
    user_id = query.from_user.id
    
    booking_system.user_sessions[user_id] = {"service": service}
    
    await query.edit_message_text(
        f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞: {service}*\n\n*–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞:*",
        reply_markup=booking_system.get_master_keyboard(service),
        parse_mode="Markdown"
    )

async def handle_master(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –º–∞—Å—Ç–µ—Ä–∞"""
    query = update.callback_query
    await query.answer()
    
    if query.data == "back_to_services":
        await query.edit_message_text(
            "‚úÇÔ∏è *–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:*",
            reply_markup=booking_system.get_service_keyboard(),
            parse_mode="Markdown"
        )
        return
    
    master = query.data.replace("master_", "")
    user_id = query.from_user.id
    
    if user_id not in booking_system.user_sessions:
        booking_system.user_sessions[user_id] = {}
    
    booking_system.user_sessions[user_id]["master"] = master
    
    await query.edit_message_text(
        f"‚úÇÔ∏è *{booking_system.user_sessions[user_id]['service']}*\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä: {master}*\n\n"
        f"*–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:*",
        reply_markup=booking_system.get_calendar_keyboard(),
        parse_mode="Markdown"
    )

async def handle_date(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã"""
    query = update.callback_query
    await query.answer()
    
    if query.data == "back_to_calendar":
        user_id = query.from_user.id
        session = booking_system.user_sessions.get(user_id, {})
        await query.edit_message_text(
            f"‚úÇÔ∏è *{session.get('service', '')}*\n"
            f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä: {session.get('master', '')}*\n\n"
            f"*–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:*",
            reply_markup=booking_system.get_calendar_keyboard(),
            parse_mode="Markdown"
        )
        return
    
    date_str = query.data.replace("date_", "")
    user_id = query.from_user.id
    
    if user_id not in booking_system.user_sessions:
        await query.edit_message_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.")
        return
    
    booking_system.user_sessions[user_id]["date"] = date_str
    
    date_display = datetime.datetime.strptime(date_str, "%Y-%m-%d").strftime("%d.%m.%Y")
    master = booking_system.user_sessions[user_id]["master"]
    
    await query.edit_message_text(
        f"‚úÇÔ∏è *{booking_system.user_sessions[user_id]['service']}*\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä: {master}*\n"
        f"üìÖ *–î–∞—Ç–∞: {date_display}*\n\n"
        f"*–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è:*",
        reply_markup=booking_system.get_time_keyboard(date_str, master),
        parse_mode="Markdown"
    )

async def handle_time(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏"""
    query = update.callback_query
    await query.answer()
    
    time_str = query.data.replace("time_", "")
    user_id = query.from_user.id
    
    if user_id not in booking_system.user_sessions:
        await query.edit_message_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.")
        return
    
    session = booking_system.user_sessions[user_id]
    session["time"] = time_str
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
    is_valid, message = validation_system.validate_booking_time(
        session['date'], session['time'], session['master']
    )
    
    if not is_valid:
        await query.edit_message_text(message)
        return
    
    date_display = datetime.datetime.strptime(session["date"], "%Y-%m-%d").strftime("%d.%m.%Y")
    price = CONFIG["services"][session["service"]]
    
    confirmation_text = (
        f"‚úÖ *–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ó–ê–ü–ò–°–ò*\n\n"
        f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞:* {session['service']}\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä:* {session['master']}\n"
        f"üìÖ *–î–∞—Ç–∞:* {date_display}\n"
        f"‚è∞ *–í—Ä–µ–º—è:* {time_str}\n"
        f"üí∞ *–°—Ç–æ–∏–º–æ—Å—Ç—å:* {price}‚ÇΩ\n\n"
        f"–í—Å—ë –≤–µ—Ä–Ω–æ?"
    )
    
    keyboard = [
        [InlineKeyboardButton("‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", callback_data="confirm_yes"),
         InlineKeyboardButton("‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", callback_data="confirm_no")]
    ]
    
    await query.edit_message_text(
        confirmation_text,
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )

async def handle_confirmation(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏"""
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    session = booking_system.user_sessions.get(user_id)
    
    if not session:
        await query.edit_message_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ /start")
        return
    
    if query.data == "confirm_yes":
        # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å
        booking_id = f"{user_id}_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}"
        price = CONFIG["services"][session["service"]]
        
        appointment_data = {
            "id": booking_id,
            "user_id": user_id,
            "user_name": query.from_user.first_name,
            "service": session["service"],
            "master": session["master"],
            "date": session["date"],
            "time": session["time"],
            "price": price,
            "status": "confirmed"
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        db.save_appointment(appointment_data)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        bookings[booking_id] = appointment_data
        
        date_display = datetime.datetime.strptime(session["date"], "%Y-%m-%d").strftime("%d.%m.%Y")
        
        await query.edit_message_text(
            f"üéâ *–ó–ê–ü–ò–°–¨ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê!*\n\n"
            f"‚úÖ *–î–µ—Ç–∞–ª–∏ –∑–∞–ø–∏—Å–∏:*\n"
            f"‚Ä¢ –£—Å–ª—É–≥–∞: {session['service']}\n"
            f"‚Ä¢ –ú–∞—Å—Ç–µ—Ä: {session['master']}\n"
            f"‚Ä¢ –î–∞—Ç–∞: {date_display}\n"
            f"‚Ä¢ –í—Ä–µ–º—è: {session['time']}\n"
            f"‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: {price}‚ÇΩ\n\n"
            f"üìû *–ö–æ–Ω—Ç–∞–∫—Ç—ã:* +7 (999) 123-45-67\n"
            f"üìç *–ê–¥—Ä–µ—Å:* —É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, 123\n\n"
            f"üí° *–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /mybookings –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å—è–º–∏*",
            parse_mode="Markdown"
        )
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏ –º–∞—Å—Ç–µ—Ä—É
        await send_booking_notification(booking_id)
        
    else:
        await query.edit_message_text("‚ùå –ó–∞–ø–∏—Å—å –æ—Ç–º–µ–Ω–µ–Ω–∞")
    
    # –û—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é
    if user_id in booking_system.user_sessions:
        del booking_system.user_sessions[user_id]

async def send_booking_notification(booking_id):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏"""
    try:
        app = Application.builder().token(CONFIG["token"]).build()
        
        cursor = db.conn.cursor()
        cursor.execute('''
            SELECT a.*, c.first_name 
            FROM appointments a 
            JOIN clients c ON a.user_id = c.user_id 
            WHERE a.id = ?
        ''', (booking_id,))
        booking = cursor.fetchone()
        
        if booking:
            # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
            await app.bot.send_message(
                chat_id=CONFIG['admin_id'],
                text=f"üîî –ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨!\n"
                     f"–ö–ª–∏–µ–Ω—Ç: {booking[11]}\n"
                     f"–£—Å–ª—É–≥–∞: {booking[2]}\n"
                     f"–ú–∞—Å—Ç–µ—Ä: {booking[3]}\n"
                     f"–î–∞—Ç–∞: {booking[4]} {booking[5]}\n"
                     f"–°—Ç–æ–∏–º–æ—Å—Ç—å: {booking[6]}‚ÇΩ"
            )
            
            # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É
            cursor.execute('SELECT telegram_id FROM masters WHERE name = ?', (booking[3],))
            master_info = cursor.fetchone()
            
            if master_info and master_info[0]:
                await app.bot.send_message(
                    chat_id=master_info[0],
                    text=f"üìÖ –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –∫ –≤–∞–º!\n"
                         f"–£—Å–ª—É–≥–∞: {booking[2]}\n"
                         f"–î–∞—Ç–∞: {booking[4]}\n"
                         f"–í—Ä–µ–º—è: {booking[5]}\n"
                         f"–ö–ª–∏–µ–Ω—Ç: {booking[11]}"
                )
                
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}")

async def my_bookings(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = update.effective_user.id
    appointments = db.get_client_appointments(user_id)
    
    if not appointments:
        await update.message.reply_text("üì≠ –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.")
        return
    
    text = "üìã *–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏:*\n\n"
    keyboard = []
    
    for appointment in appointments:
        date_display = datetime.datetime.strptime(appointment[4], "%Y-%m-%d").strftime("%d.%m.%Y")
        text += (
            f"‚úÇÔ∏è {appointment[2]}\n"
            f"üë®‚Äçüíº {appointment[3]}\n"
            f"üìÖ {date_display} ‚è∞ {appointment[5]}\n"
            f"üí∞ {appointment[6]}‚ÇΩ\n\n"
        )
        
        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã
        keyboard.append([InlineKeyboardButton(
            f"‚ùå –û—Ç–º–µ–Ω–∏—Ç—å {appointment[2][:10]}... {date_display} {appointment[5]}",
            callback_data=f"cancel_{appointment[0]}"
        )])
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text(text, reply_markup=reply_markup, parse_mode="Markdown")

async def cancel_booking(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–ø–∏—Å–∏"""
    query = update.callback_query
    await query.answer()
    
    booking_id = query.data.replace("cancel_", "")
    
    if db.cancel_appointment(booking_id):
        await query.edit_message_text("‚úÖ –ó–∞–ø–∏—Å—å –æ—Ç–º–µ–Ω–µ–Ω–∞.")
        
        # –£–¥–∞–ª—è–µ–º –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        if booking_id in bookings:
            del bookings[booking_id]
    else:
        await query.edit_message_text("‚ùå –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ —É–∂–µ –æ—Ç–º–µ–Ω–µ–Ω–∞.")

print("‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 9: –ó–ê–ü–£–°–ö –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ë–û–¢–ê
def setup_application():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    application = Application.builder().token(CONFIG["token"]).build()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("mybookings", my_bookings))
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback'–æ–≤
    application.add_handler(CallbackQueryHandler(role_system.handle_role_selection, pattern="^role_"))
    application.add_handler(CallbackQueryHandler(handle_service, pattern="^service_"))
    application.add_handler(CallbackQueryHandler(handle_master, pattern="^master_"))
    application.add_handler(CallbackQueryHandler(handle_date, pattern="^date_"))
    application.add_handler(CallbackQueryHandler(handle_time, pattern="^time_"))
    application.add_handler(CallbackQueryHandler(handle_confirmation, pattern="^confirm_"))
    application.add_handler(CallbackQueryHandler(cancel_booking, pattern="^cancel_"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è Mini-Apps
    application.add_handler(CallbackQueryHandler(schedule_viewer.quick_schedule, pattern="^quick_schedule$"))
    application.add_handler(CallbackQueryHandler(schedule_viewer.show_master_schedule, pattern="^view_master_schedule_"))
    application.add_handler(CallbackQueryHandler(handle_master, pattern="^book_with_"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–æ–ª–µ–≤—ã—Ö –º–µ–Ω—é
    application.add_handler(CallbackQueryHandler(role_system.show_admin_menu, pattern="^admin_"))
    application.add_handler(CallbackQueryHandler(role_system.show_master_menu, pattern="^master_"))
    application.add_handler(CallbackQueryHandler(role_system.show_client_menu, pattern="^client_"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    application.add_handler(CallbackQueryHandler(start, pattern="^restart$"))
    application.add_handler(CallbackQueryHandler(schedule_viewer.quick_schedule, pattern="^back_to_schedule$"))
    application.add_handler(CallbackQueryHandler(handle_date, pattern="^back_to_calendar$"))
    application.add_handler(CallbackQueryHandler(handle_service, pattern="^back_to_services$"))
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    application.add_error_handler(error_handler.handle_error)
    
    return application

async def run_bot():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""
    application = setup_application()
    
    print("=" * 60)
    print("ü§ñ BARBERPRO BOT –ó–ê–ü–£–©–ï–ù!")
    print(f"üîë –¢–æ–∫–µ–Ω: {CONFIG['token']}")
    print(f"üëë –ê–¥–º–∏–Ω: {CONFIG['admin_id']}")
    print(f"üë®‚Äçüíº –ú–∞—Å—Ç–µ—Ä–∞: {list(CONFIG['masters'].keys())}")
    print("‚è∞ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∞–∫—Ç–∏–≤–Ω–∞")
    print("üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞")
    print("üîÑ –ê–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω")
    print("=" * 60)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    await application.run_polling()

# –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –¥–ª—è Colab —Å –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
def start_system():
    """–ó–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã —Å –∞–≤—Ç–æ-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º"""
    max_retries = 5
    retry_count = 0
    
    while retry_count < max_retries:
        try:
            print(f"üîÑ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞ #{retry_count + 1}")
            asyncio.run(run_bot())
        except KeyboardInterrupt:
            print("\nüõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
            break
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {e}")
            retry_count += 1
            if retry_count < max_retries:
                wait_time = 2 ** retry_count  # –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
                print(f"‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ {wait_time} —Å–µ–∫—É–Ω–¥...")
                time.sleep(wait_time)
            else:
                print("üö® –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å")
                break

print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∞")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 10: –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´
if __name__ == '__main__':
    print("üöÄ –ó–ê–ü–£–°–ö–ê–ï–ú BARBERPRO SYSTEM...")
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    print("üîß –í—ã–ø–æ–ª–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É...")
    
    # –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É
    for booking_id, booking in list(bookings.items()):
        db.save_appointment(booking)
    
    print("üìä –î–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –±–∞–∑—É")
    print("üéâ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï!")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º—É
    start_system()üéØ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:`/start` - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º`/mybookings` - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏–†–æ–ª–µ–≤–æ–µ –º–µ–Ω—é:üë§ –ö–ª–∏–µ–Ω—Ç - –∑–∞–ø–∏—Å—å, –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–æ—Ç–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏üë®‚Äçüíº –ú–∞—Å—Ç–µ—Ä - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∫–ª–∏–µ–Ω—Ç—ãüëë –ê–¥–º–∏–Ω - –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏:–í—ã–±–æ—Ä —É—Å–ª—É–≥–∏–í—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–∞–í—ã–±–æ—Ä –¥–∞—Ç—ã–í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ:–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞–£–º–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –∏ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 24 –∏ 3 —á–∞—Å–∞–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫Mini-Apps –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–ê–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–±–æ—è—Ö –≤ Colab–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–º—è—Ç–∏ –≤ –ë–îüéä –°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï!

user: Mini-Apps —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ,–∑–∞–≥–ª—É—à–∫–∏ –µ—Å—Ç—å?

assistant: üîç –ü—Ä–æ–≤–µ–¥–µ–º –∞–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Mini-Apps –∏ –≤—ã—è–≤–∏–º –∑–∞–≥–ª—É—à–∫–∏:üö® –í–´–Ø–í–õ–ï–ù–ù–´–ï –ó–ê–ì–õ–£–®–ö–ò –í MINI-APPS:1. –ó–ê–ì–õ–£–®–ö–ê: –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –í –ë–õ–û–ö–ï 7: ScheduleViewer.show_master_schedule –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç "schedule_tomorrow"
# –î–û–ë–ê–í–ò–¢–¨ –í –ë–õ–û–ö 7:

@staticmethod
async def show_tomorrow_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"""
    query = update.callback_query
    await query.answer()
    
    tomorrow = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
    
    keyboard = []
    for master in CONFIG['masters']:
        available_times = booking_system.generate_available_times(tomorrow, master)
        if available_times:
            status = f"üü¢ {len(available_times)} —Å–ª–æ—Ç–æ–≤"
        else:
            status = "üî¥ –ó–∞–Ω—è—Ç–æ"
        
        keyboard.append([
            InlineKeyboardButton(
                f"üë®‚Äçüíº {master} - {status}", 
                callback_data=f"view_tomorrow_master_{master}"
            )
        ])
    
    tomorrow_display = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%d.%m.%Y")
    
    await query.edit_message_text(
        f"üìä *–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞* ({tomorrow_display})\n\n"
        f"–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:",
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )

@staticmethod
async def show_tomorrow_master_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"""
    query = update.callback_query
    await query.answer()
    
    master = query.data.replace("view_tomorrow_master_", "")
    tomorrow = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
    
    available_times = booking_system.generate_available_times(tomorrow, master)
    
    tomorrow_display = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%d.%m.%Y")
    
    if available_times:
        times_text = "\n".join([f"‚Ä¢ {time}" for time in available_times[:6]])
        message = f"üë®‚Äçüíº *{master}* - —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞ ({tomorrow_display}):\n\n{times_text}"
        
        if len(available_times) > 6:
            message += f"\n\n... –∏ –µ—â–µ {len(available_times) - 6} —Å–ª–æ—Ç–æ–≤"
    else:
        message = f"üë®‚Äçüíº *{master}* - –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"
    
    keyboard = [
        [InlineKeyboardButton("‚úèÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –º–∞—Å—Ç–µ—Ä—É", callback_data=f"book_with_{master}")],
        [InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é", callback_data="back_to_schedule")]
    ]
    
    await query.edit_message_text(
        message,
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )2. –ó–ê–ì–õ–£–®–ö–ê: –°–∏—Å—Ç–µ–º–∞ –æ–∂–∏–¥–∞–Ω–∏—è —Å–ª–æ—Ç–æ–≤python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –î–û–ë–ê–í–ò–¢–¨ –í –ë–õ–û–ö 7:

class SlotNotifications:
    def __init__(self, database):
        self.db = database
        self.waiting_list = {}
        self.scheduler = BackgroundScheduler()
        self.scheduler.start()
    
    async def add_to_waiting_list(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"""
        query = update.callback_query
        await query.answer()
        
        user_id = query.from_user.id
        data = query.data.replace("wait_for_slot_", "").split("|")
        
        if len(data) == 2:
            master, service = data[0], data[1]
            
            self.waiting_list[user_id] = {
                "master": master,
                "service": service,
                "added_at": datetime.datetime.now(),
                "notified": False
            }
            
            await query.edit_message_text(
                f"üîî *–í—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è!*\n\n"
                f"–ú—ã —É–≤–µ–¥–æ–º–∏–º –≤–∞—Å, –∫–æ–≥–¥–∞ —É *{master}* –ø–æ—è–≤–∏—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è *{service}*.\n\n"
                f"‚ö° –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!",
                parse_mode="Markdown"
            )
            
            # –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
            self.scheduler.add_job(
                self.check_slots_for_user,
                'date',
                run_date=datetime.datetime.now() + datetime.timedelta(seconds=10),
                args=[user_id]
            )
    
    async def check_slots_for_user(self, user_id):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if user_id not in self.waiting_list:
            return
            
        request = self.waiting_list[user_id]
        master = request['master']
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–∏–∂–∞–π—à–∏–µ 3 –¥–Ω—è
        for days_ahead in range(1, 4):
            check_date = (datetime.datetime.now() + datetime.timedelta(days=days_ahead)).strftime("%Y-%m-%d")
            available_times = booking_system.generate_available_times(check_date, master)
            
            if available_times and not request['notified']:
                await self.notify_user_about_slots(user_id, check_date, available_times, master)
                request['notified'] = True
                break
    
    async def notify_user_about_slots(self, user_id, date, times, master):
        """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            
            date_display = datetime.datetime.strptime(date, "%Y-%m-%d").strftime("%d.%m.%Y")
            times_text = ", ".join(times[:5])  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 5 —Å–ª–æ—Ç–æ–≤
            
            await app.bot.send_message(
                chat_id=user_id,
                text=f"üéâ *–ü–æ—è–≤–∏–ª–æ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è!*\n\n"
                     f"–£ *{master}* –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã:\n"
                     f"üìÖ *–î–∞—Ç–∞:* {date_display}\n"
                     f"‚è∞ *–í—Ä–µ–º—è:* {times_text}\n\n"
                     f"‚ö° [–ó–∞–ø–∏—Å–∞—Ç—å—Å—è —Å–µ–π—á–∞—Å](https://t.me/your_bot?start=quick_booking)",
                parse_mode="Markdown"
            )
            
            print(f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}")
    
    def start_background_checker(self):
        """–ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ª–æ—Ç–æ–≤"""
        self.scheduler.add_job(
            self.cleanup_old_requests,
            'interval',
            hours=1
        )
    
    def cleanup_old_requests(self):
        """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)"""
        current_time = datetime.datetime.now()
        users_to_remove = []
        
        for user_id, request in self.waiting_list.items():
            if (current_time - request['added_at']).days > 7:
                users_to_remove.append(user_id)
        
        for user_id in users_to_remove:
            del self.waiting_list[user_id]
        
        if users_to_remove:
            print(f"üßπ –û—á–∏—â–µ–Ω–æ {len(users_to_remove)} —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–∂–∏–¥–∞–Ω–∏—è")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
slot_notifier = SlotNotifications(db)
slot_notifier.start_background_checker()3. –ó–ê–ì–õ–£–®–ö–ê: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—èpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –î–û–ë–ê–í–ò–¢–¨ –í –ë–õ–û–ö 8 (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏):

async def handle_no_slots(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"""
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    session = booking_system.user_sessions.get(user_id, {})
    
    if session.get('service') and session.get('master'):
        service = session['service']
        master = session['master']
        
        keyboard = [
            [InlineKeyboardButton("üîî –£–≤–µ–¥–æ–º–∏—Ç—å –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö", 
                                callback_data=f"wait_for_slot_{master}|{service}")],
            [InlineKeyboardButton("üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞", callback_data="back_to_masters")],
            [InlineKeyboardButton("üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É", callback_data="back_to_calendar")]
        ]
        
        await query.edit_message_text(
            f"üòî *–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤*\n\n"
            f"–£ *{master}* –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è *{service}*.\n\n"
            f"–í—ã –º–æ–∂–µ—Ç–µ:\n"
            f"‚Ä¢ üîî –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–ª–æ—Ç–æ–≤\n"
            f"‚Ä¢ üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞\n"
            f"‚Ä¢ üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )

# –î–û–ë–ê–í–ò–¢–¨ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é handle_time:
async def handle_time(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –ü–†–û–í–ï–†–Ø–ï–ú –ï–°–¢–¨ –õ–ò –°–í–û–ë–û–î–ù–´–ï –°–õ–û–¢–´
    available_times = booking_system.generate_available_times(session['date'], session['master'])
    if not available_times:
        # –ï–°–õ–ò –°–õ–û–¢–û–í –ù–ï–¢ - –ü–†–ï–î–õ–ê–ì–ê–ï–ú –í–ê–†–ò–ê–ù–¢–´
        keyboard = [
            [InlineKeyboardButton("üîî –£–≤–µ–¥–æ–º–∏—Ç—å –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö", 
                                callback_data=f"wait_for_slot_{session['master']}|{session['service']}")],
            [InlineKeyboardButton("üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞", callback_data="back_to_masters")],
            [InlineKeyboardButton("üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É", callback_data="back_to_calendar")]
        ]
        
        await query.edit_message_text(
            f"üòî *–ù–∞ —ç—Ç—É –¥–∞—Ç—É –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤*\n\n"
            f"–£ *{session['master']}* –Ω–∞ {date_display} –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.\n\n"
            f"–í—ã –º–æ–∂–µ—Ç–µ:\n"
            f"‚Ä¢ üîî –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–ª–æ—Ç–æ–≤\n"
            f"‚Ä¢ üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞\n"
            f"‚Ä¢ üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
        return
    
    # ... –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ ...4. –ó–ê–ì–õ–£–®–ö–ê: –£–ª—É—á—à–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –î–û–ë–ê–í–ò–¢–¨ –í –ë–õ–û–ö 5 (BookingSystem):

def get_enhanced_calendar_keyboard(self, current_page=0):
    """–£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π"""
    days_per_page = 7
    start_day = current_page * days_per_page + 1
    end_day = start_day + days_per_page
    
    keyboard = []
    today = datetime.date.today()
    
    for i in range(start_day, end_day):
        date = today + datetime.timedelta(days=i)
        
        if date.weekday() in CONFIG["work_days"]:
            date_str = date.strftime("%d.%m")
            day_name = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"][date.weekday()]
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã
            has_slots = False
            for master in CONFIG["masters"]:
                if self.generate_available_times(date.strftime("%Y-%m-%d"), master):
                    has_slots = True
                    break
            
            emoji = "üü¢" if has_slots else "üî¥"
            button_text = f"{emoji} {date_str} ({day_name})"
            
            keyboard.append([
                InlineKeyboardButton(button_text, callback_data=f"date_{date.strftime('%Y-%m-%d')}")
            ])
    
    # –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    nav_buttons = []
    if current_page > 0:
        nav_buttons.append(InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data=f"calendar_page_{current_page-1}"))
    
    if end_day <= 28:  # –ú–∞–∫—Å–∏–º—É–º 4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        nav_buttons.append(InlineKeyboardButton("–í–ø–µ—Ä–µ–¥ ‚û°Ô∏è", callback_data=f"calendar_page_{current_page+1}"))
    
    if nav_buttons:
        keyboard.append(nav_buttons)
    
    keyboard.append([InlineKeyboardButton("üéØ –°–µ–≥–æ–¥–Ω—è", callback_data="date_today")])
    
    return InlineKeyboardMarkup(keyboard)

# –î–û–ë–ê–í–ò–¢–¨ –û–ë–†–ê–ë–û–¢–ß–ò–ö –í –ë–õ–û–ö 8:
async def handle_calendar_page(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –∫–∞–ª–µ–Ω–¥–∞—Ä—è"""
    query = update.callback_query
    await query.answer()
    
    page = int(query.data.replace("calendar_page_", ""))
    user_id = query.from_user.id
    
    session = booking_system.user_sessions.get(user_id, {})
    
    await query.edit_message_text(
        f"‚úÇÔ∏è *{session.get('service', '')}*\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä: {session.get('master', '')}*\n\n"
        f"*–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ {page + 1}):*",
        reply_markup=booking_system.get_enhanced_calendar_keyboard(page),
        parse_mode="Markdown"
    )

async def handle_today_date(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã"""
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    today = datetime.datetime.now().strftime("%Y-%m-%d")
    
    if user_id not in booking_system.user_sessions:
        await query.edit_message_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.")
        return
    
    booking_system.user_sessions[user_id]["date"] = today
    
    date_display = datetime.datetime.now().strftime("%d.%m.%Y")
    master = booking_system.user_sessions[user_id]["master"]
    
    await query.edit_message_text(
        f"‚úÇÔ∏è *{booking_system.user_sessions[user_id]['service']}*\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä: {master}*\n"
        f"üìÖ *–î–∞—Ç–∞: {date_display} (–°–µ–≥–æ–¥–Ω—è)*\n\n"
        f"*–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è:*",
        reply_markup=booking_system.get_time_keyboard(today, master),
        parse_mode="Markdown"
    )5. –ó–ê–ì–õ–£–®–ö–ê: –ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å –ø–æ —Å—Å—ã–ª–∫–µpython–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –î–û–ë–ê–í–ò–¢–¨ –í –ë–õ–û–ö 8:

async def handle_quick_booking(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ —Å—Å—ã–ª–∫–µ"""
    user_id = update.effective_user.id
    args = context.args
    
    if args and len(args) > 0:
        # –§–æ—Ä–º–∞—Ç: /start quick_master_–ê–Ω–Ω–∞_service_—Å—Ç—Ä–∏–∂–∫–∞
        quick_data = " ".join(args)
        
        master = None
        service = None
        
        if "master_" in quick_data and "service_" in quick_data:
            try:
                master = quick_data.split("master_")[1].split(" ")[0]
                service = quick_data.split("service_")[1].split(" ")[0]
            except:
                pass
        
        if master and service and master in CONFIG["masters"] and service in CONFIG["services"]:
            # –ù–∞—á–∏–Ω–∞–µ–º –±—ã—Å—Ç—Ä—É—é –∑–∞–ø–∏—Å—å
            booking_system.user_sessions[user_id] = {
                "service": service,
                "master": master
            }
            
            await update.message.reply_text(
                f"‚ö° *–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å!*\n\n"
                f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞:* {service}\n"
                f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä:* {master}\n\n"
                f"*–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:*",
                reply_markup=booking_system.get_enhanced_calendar_keyboard(),
                parse_mode="Markdown"
            )
            return
    
    # –ï—Å–ª–∏ –Ω–µ –±—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç
    await role_system.show_role_selection(update, context)üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –î–õ–Ø –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –ó–ê–ì–õ–£–®–ï–ö:–ò–°–ü–†–ê–í–ò–¢–¨ –í –ë–õ–û–ö–ï 9 (setup_application):python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—ådef setup_application():
    application = Application.builder().token(CONFIG["token"]).build()
    
    # –ó–ê–ú–ï–ù–ò–¢–¨ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ /start:
    application.add_handler(CommandHandler("start", handle_quick_booking))
    
    # –î–û–ë–ê–í–ò–¢–¨ –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
    application.add_handler(CallbackQueryHandler(schedule_viewer.show_tomorrow_schedule, pattern="^schedule_tomorrow$"))
    application.add_handler(CallbackQueryHandler(schedule_viewer.show_tomorrow_master_schedule, pattern="^view_tomorrow_master_"))
    application.add_handler(CallbackQueryHandler(slot_notifier.add_to_waiting_list, pattern="^wait_for_slot_"))
    application.add_handler(CallbackQueryHandler(handle_no_slots, pattern="^no_slots_"))
    application.add_handler(CallbackQueryHandler(handle_calendar_page, pattern="^calendar_page_"))
    application.add_handler(CallbackQueryHandler(handle_today_date, pattern="^date_today$"))
    application.add_handler(CallbackQueryHandler(handle_master, pattern="^back_to_masters$"))
    
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ...
    
    return applicationüéØ –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–° MINI-APPS:‚úÖ –£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–æ—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–ø–∏—Å—è—Ö–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ãüö® –ó–ê–ì–õ–£–®–ö–ò, –ö–û–¢–û–†–´–ï –ë–´–õ–ò –ò–°–ü–†–ê–í–õ–ï–ù–´:–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å–°–∏—Å—Ç–µ–º–∞ –æ–∂–∏–¥–∞–Ω–∏—è —Å–ª–æ—Ç–æ–≤ - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è–£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å –ø–æ —Å—Å—ã–ª–∫–µ - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–ª—É–±–æ–∫–∏—Ö —Å—Å—ã–ª–æ–∫–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–ª–æ—Ç–æ–≤ - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã‚ö° –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï MINI-APPS:Smart Notifications - —É–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—ÖEnhanced Calendar - –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏Quick Booking Links - –≥–ª—É–±–æ–∫–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏Slot Waiting List - –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏üéä –í–°–ï MINI-APPS –¢–ï–ü–ï–†–¨ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–´ –ë–ï–ó –ó–ê–ì–õ–£–®–ï–ö!–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º.

user: –ª–∏–∫–≤–∏–¥–∏—Ä—É–π –∑–∞–≥–ª—É—à–∫–∏ —Ä–∞–±–æ—á–∏–º –∫–æ–¥–æ–º —á—Ç–æ –±—ã –≤–µ—Å—å –∑–∞—è–≤–ª–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±—ã–ª —Ä–∞–±–æ—á–∏–º

assistant: ÊÄùËÄÉÔºö–ú—ã —É–∂–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –∑–∞–≥–ª—É—à–∫–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏ –∫–æ–¥ –¥–ª—è –∏—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è. –¢–µ–ø–µ—Ä—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º –≤–µ—Å—å —ç—Ç–æ—Ç –∫–æ–¥ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.–ü–ª–∞–Ω:–î–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å SlotNotifications –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ–≥–æ.–†–∞—Å—à–∏—Ä–∏–º –∫–ª–∞—Å—Å ScheduleViewer –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞.–î–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö callback'–æ–≤.–û–±–Ω–æ–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é setup_application, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.–í–Ω–µ—Å–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –≥–¥–µ –±—ã–ª–∏ –∑–∞–≥–ª—É—à–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, handle_time, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª—É—á–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–ª–æ—Ç–æ–≤).–û–¥–Ω–∞–∫–æ, —É—á—Ç–µ–º, —á—Ç–æ –∫–æ–¥ —É–∂–µ —Ä–∞–∑–±–∏—Ç –Ω–∞ –±–ª–æ–∫–∏. –ú—ã –±—É–¥–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–¥ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –±–ª–æ–∫–∏, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ—á–∏—Å–ª–∏–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.–ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –Ω–µ –º–æ–∂–µ–º –∏–∑–º–µ–Ω–∏—Ç—å —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏, —è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—è —Å —Ç–µ—Ö, –≥–¥–µ –±—ã–ª–∏ –∑–∞–≥–ª—É—à–∫–∏.–í–∞–∂–Ω–æ: –ú—ã –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —á—Ç–æ–±—ã –∫–æ–¥ –±—ã–ª —Ä–∞–±–æ—á–∏–º.–î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Å –±–ª–æ–∫–∞ 7 (Mini-Apps), –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏–º –±–ª–æ–∫ 8 (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏) –∏ –±–ª–æ–∫ 9 (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è).–ù–æ note: –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –º—ã —É–∂–µ –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏ –∫–æ–¥ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥–ª—É—à–µ–∫. –¢–µ–ø–µ—Ä—å –º—ã –µ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º.–ú—ã –±—É–¥–µ–º:–ó–∞–º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã/—Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏.–î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏.–ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º, —è –Ω–∞–ø–∏—à—É –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Ü–µ–ª–∏–∫–æ–º, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ.–ë–õ–û–ö 7 (Mini-Apps) –±—É–¥–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω:–î–æ–±–∞–≤–∏–º –∫–ª–∞—Å—Å SlotNotifications–†–∞—Å—à–∏—Ä–∏–º ScheduleViewer –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è –∑–∞–≤—Ç—Ä–∞ –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º–ë–õ–û–ö 8 (–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏) –±—É–¥–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω:–î–æ–±–∞–≤–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö callback'–æ–≤–ë–õ–û–ö 9 (–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) –æ–±–Ω–æ–≤–∏–º, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.–¢–∞–∫–∂–µ –º—ã –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å –ë–õ–û–ö 5 (BookingSystem) –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è.–î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Å –ë–õ–û–ö–ê 5 (BookingSystem) - –¥–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ get_enhanced_calendar_keyboard –∏ –æ–±–Ω–æ–≤–∏–º generate_available_times, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.–û–¥–Ω–∞–∫–æ, note: –≤ –ë–õ–û–ö–ï 5 —É–∂–µ –µ—Å—Ç—å generate_available_times, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –û—Å—Ç–∞–≤–∏–º –µ–≥–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.–¢–µ–ø–µ—Ä—å, –ø–æ –ø–æ—Ä—è–¥–∫—É:–û–±–Ω–æ–≤–∏–º –ë–õ–û–ö 5 (BookingSystem) - –¥–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è.–ó–∞—Ç–µ–º –ë–õ–û–ö 7 (Mini-Apps) - –¥–æ–±–∞–≤–∏–º –∫–ª–∞—Å—Å SlotNotifications –∏ —Ä–∞—Å—à–∏—Ä–∏–º ScheduleViewer.–ó–∞—Ç–µ–º –ë–õ–û–ö 8 (–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏) - –¥–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.–ó–∞—Ç–µ–º –ë–õ–û–ö 9 (–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) - –¥–æ–±–∞–≤–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.–ù–æ note: –≤ –ë–õ–û–ö–ï 7 —É–∂–µ –µ—Å—Ç—å –∫–ª–∞—Å—Å ScheduleViewer –∏ NotificationSystem. –ú—ã –∏—Ö —Ä–∞—Å—à–∏—Ä–∏–º.–¢–∞–∫–∂–µ note: –≤ –ë–õ–û–ö–ï 8 —É–∂–µ –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –º—ã –¥–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–µ.–ß—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫, —è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—é –∫–∞–∂–¥—ã–π –±–ª–æ–∫ –≤ —Ç–æ–º –≤–∏–¥–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.–ü–æ–µ—Ö–∞–ª–∏!–ë–õ–û–ö 5 (BookingSystem) - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π:python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 5: –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø –° –ü–û–õ–ù–´–ú –§–£–ù–ö–¶–ò–û–ù–ê–õ–û–ú
class BookingSystem:
    def __init__(self):
        self.user_sessions = {}
    
    def get_service_keyboard(self):
        """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å —É—Å–ª—É–≥–∞–º–∏"""
        keyboard = []
        for service, price in CONFIG["services"].items():
            keyboard.append([
                InlineKeyboardButton(
                    f"‚úÇÔ∏è {service} - {price}‚ÇΩ", 
                    callback_data=f"service_{service}"
                )
            ])
        return InlineKeyboardMarkup(keyboard)
    
    def get_master_keyboard(self, service):
        """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –º–∞—Å—Ç–µ—Ä–∞–º–∏ –¥–ª—è —É—Å–ª—É–≥–∏"""
        keyboard = []
        
        # –§–∏–ª—å—Ç—Ä—É–µ–º –º–∞—Å—Ç–µ—Ä–æ–≤ –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        for master_name, master_info in CONFIG["masters"].items():
            if service in master_info["specialization"]:
                keyboard.append([
                    InlineKeyboardButton(f"üë®‚Äçüíº {master_name}", callback_data=f"master_{master_name}")
                ])
        
        if not keyboard:
            # –ï—Å–ª–∏ –Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö
            for master_name in CONFIG["masters"]:
                keyboard.append([
                    InlineKeyboardButton(f"üë®‚Äçüíº {master_name}", callback_data=f"master_{master_name}")
                ])
        
        keyboard.append([InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_services")])
        return InlineKeyboardMarkup(keyboard)
    
    def get_enhanced_calendar_keyboard(self, current_page=0):
        """–£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏"""
        days_per_page = 7
        start_day = current_page * days_per_page + 1
        end_day = start_day + days_per_page
        
        keyboard = []
        today = datetime.date.today()
        
        for i in range(start_day, end_day):
            date = today + datetime.timedelta(days=i)
            
            if date.weekday() in CONFIG["work_days"]:
                date_str = date.strftime("%d.%m")
                day_name = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°—Ä", "–í—Å"][date.weekday()]
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤
                total_slots = 0
                for master in CONFIG["masters"]:
                    available_times = self.generate_available_times(date.strftime("%Y-%m-%d"), master)
                    total_slots += len(available_times)
                
                if total_slots > 5:
                    emoji = "üü¢"
                    status = "–ú–Ω–æ–≥–æ"
                elif total_slots > 0:
                    emoji = "üü°" 
                    status = "–ú–∞–ª–æ"
                else:
                    emoji = "üî¥"
                    status = "–ù–µ—Ç"
                
                button_text = f"{emoji} {date_str} ({day_name}) - {status}"
                
                keyboard.append([
                    InlineKeyboardButton(button_text, callback_data=f"date_{date.strftime('%Y-%m-%d')}")
                ])
        
        # –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        nav_buttons = []
        if current_page > 0:
            nav_buttons.append(InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data=f"calendar_page_{current_page-1}"))
        
        if end_day <= 21:  # –ú–∞–∫—Å–∏–º—É–º 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            nav_buttons.append(InlineKeyboardButton("–í–ø–µ—Ä–µ–¥ ‚û°Ô∏è", callback_data=f"calendar_page_{current_page+1}"))
        
        if nav_buttons:
            keyboard.append(nav_buttons)
        
        # –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
        keyboard.append([InlineKeyboardButton("üéØ –°–µ–≥–æ–¥–Ω—è", callback_data="date_today")])
        
        return InlineKeyboardMarkup(keyboard)
    
    def get_time_keyboard(self, date_str, master):
        """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π"""
        times = self.generate_available_times(date_str, master)
        
        if not times:
            return None  # –ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
        
        keyboard = []
        row = []
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≤—Ä–µ–º—è –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º –¥–Ω—è
        morning_times = [t for t in times if int(t.split(':')[0]) < 12]
        day_times = [t for t in times if 12 <= int(t.split(':')[0]) < 17]
        evening_times = [t for t in times if int(t.split(':')[0]) >= 17]
        
        # –î–æ–±–∞–≤–ª—è–µ–º —É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–ª–æ—Ç—ã
        if morning_times:
            keyboard.append([InlineKeyboardButton("üåÖ –£—Ç—Ä–æ", callback_data="time_header")])
            row = []
            for time_slot in morning_times:
                row.append(InlineKeyboardButton(f"üïí {time_slot}", callback_data=f"time_{time_slot}"))
                if len(row) == 3:
                    keyboard.append(row)
                    row = []
            if row:
                keyboard.append(row)
        
        # –î–æ–±–∞–≤–ª—è–µ–º –¥–Ω–µ–≤–Ω—ã–µ —Å–ª–æ—Ç—ã
        if day_times:
            keyboard.append([InlineKeyboardButton("‚òÄÔ∏è –î–µ–Ω—å", callback_data="time_header")])
            row = []
            for time_slot in day_times:
                row.append(InlineKeyboardButton(f"üïí {time_slot}", callback_data=f"time_{time_slot}"))
                if len(row) == 3:
                    keyboard.append(row)
                    row = []
            if row:
                keyboard.append(row)
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—á–µ—Ä–Ω–∏–µ —Å–ª–æ—Ç—ã
        if evening_times:
            keyboard.append([InlineKeyboardButton("üåô –í–µ—á–µ—Ä", callback_data="time_header")])
            row = []
            for time_slot in evening_times:
                row.append(InlineKeyboardButton(f"üïí {time_slot}", callback_data=f"time_{time_slot}"))
                if len(row) == 3:
                    keyboard.append(row)
                    row = []
            if row:
                keyboard.append(row)
        
        # –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        keyboard.append([
            InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –¥–∞—Ç–∞–º", callback_data="back_to_calendar"),
            InlineKeyboardButton("üîÑ –î—Ä—É–≥–æ–π –º–∞—Å—Ç–µ—Ä", callback_data="back_to_masters")
        ])
        
        return InlineKeyboardMarkup(keyboard)
    
    def generate_available_times(self, date_str, master):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π"""
        try:
            # –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –±–∞–∑—ã
            cursor = db.conn.cursor()
            cursor.execute('''
                SELECT appointment_time FROM appointments 
                WHERE master = ? AND appointment_date = ? AND status = 'confirmed'
            ''', (master, date_str))
            
            booked_times = [row[0] for row in cursor.fetchall()]
            
            times = []
            start_time = datetime.datetime.strptime(CONFIG["working_hours"]["start"], "%H:%M")
            end_time = datetime.datetime.strptime(CONFIG["working_hours"]["end"], "%H:%M")
            lunch_start = datetime.datetime.strptime(CONFIG["working_hours"]["lunch_start"], "%H:%M")
            lunch_end = datetime.datetime.strptime(CONFIG["working_hours"]["lunch_end"], "%H:%M")
            
            current_time = start_time
            while current_time < end_time:
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
                if lunch_start <= current_time < lunch_end:
                    current_time = lunch_end
                    continue
                
                time_str = current_time.strftime("%H:%M")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–æ –ª–∏ –≤—Ä–µ–º—è
                if time_str not in booked_times:
                    times.append(time_str)
                
                current_time += datetime.timedelta(minutes=30)
            
            return times
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏: {e}")
            return []

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
booking_system = BookingSystem()python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 7: –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï MINI-APPS –ë–ï–ó –ó–ê–ì–õ–£–®–ï–ö
class ScheduleViewer:
    @staticmethod
    async def quick_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"""
        today = datetime.datetime.now().strftime("%Y-%m-%d")
        
        keyboard = []
        for master in CONFIG['masters']:
            available_times = booking_system.generate_available_times(today, master)
            slot_count = len(available_times)
            
            if slot_count > 5:
                status = f"üü¢ {slot_count} —Å–ª–æ—Ç–æ–≤"
            elif slot_count > 0:
                status = f"üü° {slot_count} —Å–ª–æ—Ç–∞" 
            else:
                status = "üî¥ –ó–∞–Ω—è—Ç–æ"
            
            keyboard.append([
                InlineKeyboardButton(
                    f"üë®‚Äçüíº {master} - {status}", 
                    callback_data=f"view_master_schedule_{master}"
                )
            ])
        
        keyboard.append([InlineKeyboardButton("üìÖ –ù–∞ –∑–∞–≤—Ç—Ä–∞", callback_data="schedule_tomorrow")])
        keyboard.append([InlineKeyboardButton("üìã –í—Å–µ –º–∞—Å—Ç–µ—Ä–∞", callback_data="view_all_masters")])
        
        await update.message.reply_text(
            f"üìä *–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è* ({datetime.datetime.now().strftime('%d.%m.%Y')})\n\n"
            f"–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
    
    @staticmethod
    async def show_tomorrow_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"""
        query = update.callback_query
        await query.answer()
        
        tomorrow = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        tomorrow_display = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%d.%m.%Y")
        
        keyboard = []
        for master in CONFIG['masters']:
            available_times = booking_system.generate_available_times(tomorrow, master)
            slot_count = len(available_times)
            
            if slot_count > 5:
                status = f"üü¢ {slot_count} —Å–ª–æ—Ç–æ–≤"
            elif slot_count > 0:
                status = f"üü° {slot_count} —Å–ª–æ—Ç–∞"
            else:
                status = "üî¥ –ó–∞–Ω—è—Ç–æ"
            
            keyboard.append([
                InlineKeyboardButton(
                    f"üë®‚Äçüíº {master} - {status}", 
                    callback_data=f"view_tomorrow_master_{master}"
                )
            ])
        
        keyboard.append([InlineKeyboardButton("üìÖ –ù–∞ —Å–µ–≥–æ–¥–Ω—è", callback_data="back_to_schedule")])
        
        await query.edit_message_text(
            f"üìä *–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞* ({tomorrow_display})\n\n"
            f"–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:",
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
    
    @staticmethod
    async def show_master_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"""
        query = update.callback_query
        await query.answer()
        
        master = query.data.replace("view_master_schedule_", "")
        today = datetime.datetime.now().strftime("%Y-%m-%d")
        
        available_times = booking_system.generate_available_times(today, master)
        
        if available_times:
            # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≤—Ä–µ–º—è –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
            morning = [t for t in available_times if int(t.split(':')[0]) < 12]
            day = [t for t in available_times if 12 <= int(t.split(':')[0]) < 17]
            evening = [t for t in available_times if int(t.split(':')[0]) >= 17]
            
            message = f"üë®‚Äçüíº *{master}* - —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:\n\n"
            
            if morning:
                message += f"üåÖ *–£—Ç—Ä–æ:* {', '.join(morning[:6])}\n"
            if day:
                message += f"‚òÄÔ∏è *–î–µ–Ω—å:* {', '.join(day[:6])}\n"
            if evening:
                message += f"üåô *–í–µ—á–µ—Ä:* {', '.join(evening[:6])}\n"
            
            if len(available_times) > 18:
                message += f"\n... –∏ –µ—â–µ {len(available_times) - 18} —Å–ª–æ—Ç–æ–≤"
        else:
            message = f"üë®‚Äçüíº *{master}* - –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"
        
        keyboard = [
            [InlineKeyboardButton("‚úèÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –º–∞—Å—Ç–µ—Ä—É", callback_data=f"book_with_{master}")],
            [InlineKeyboardButton("üîî –£–≤–µ–¥–æ–º–∏—Ç—å –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö", callback_data=f"wait_slot_{master}")],
            [InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é", callback_data="back_to_schedule")]
        ]
        
        await query.edit_message_text(
            message,
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
    
    @staticmethod
    async def show_tomorrow_master_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"""
        query = update.callback_query
        await query.answer()
        
        master = query.data.replace("view_tomorrow_master_", "")
        tomorrow = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        tomorrow_display = (datetime.datetime.now() + datetime.timedelta(days=1)).strftime("%d.%m.%Y")
        
        available_times = booking_system.generate_available_times(tomorrow, master)
        
        if available_times:
            # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≤—Ä–µ–º—è –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
            morning = [t for t in available_times if int(t.split(':')[0]) < 12]
            day = [t for t in available_times if 12 <= int(t.split(':')[0]) < 17]
            evening = [t for t in available_times if int(t.split(':')[0]) >= 17]
            
            message = f"üë®‚Äçüíº *{master}* - —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞ ({tomorrow_display}):\n\n"
            
            if morning:
                message += f"üåÖ *–£—Ç—Ä–æ:* {', '.join(morning[:6])}\n"
            if day:
                message += f"‚òÄÔ∏è *–î–µ–Ω—å:* {', '.join(day[:6])}\n"
            if evening:
                message += f"üåô *–í–µ—á–µ—Ä:* {', '.join(evening[:6])}\n"
            
            if len(available_times) > 18:
                message += f"\n... –∏ –µ—â–µ {len(available_times) - 18} —Å–ª–æ—Ç–æ–≤"
        else:
            message = f"üë®‚Äçüíº *{master}* - –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"
        
        keyboard = [
            [InlineKeyboardButton("‚úèÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –º–∞—Å—Ç–µ—Ä—É", callback_data=f"book_with_{master}")],
            [InlineKeyboardButton("üîî –£–≤–µ–¥–æ–º–∏—Ç—å –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö", callback_data=f"wait_slot_{master}")],
            [InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é", callback_data="schedule_tomorrow")]
        ]
        
        await query.edit_message_text(
            message,
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )
    
    @staticmethod
    async def show_all_masters(update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–∞—Ö"""
        query = update.callback_query
        await query.answer()
        
        message = "üë®‚Äçüíº *–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –º–∞—Å—Ç–µ—Ä–æ–≤:*\n\n"
        
        for master_name, master_info in CONFIG["masters"].items():
            specializations = ", ".join(master_info["specialization"])
            message += f"*{master_name}*\n"
            message += f"–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: {specializations}\n"
            
            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ –∏–∑ –±–∞–∑—ã
            cursor = db.conn.cursor()
            cursor.execute('SELECT total_appointments, rating FROM masters WHERE name = ?', (master_name,))
            master_stats = cursor.fetchone()
            
            if master_stats:
                appointments, rating = master_stats
                message += f"–ó–∞–ø–∏—Å–µ–π: {appointments} | –†–µ–π—Ç–∏–Ω–≥: {rating}‚≠ê\n"
            
            message += "\n"
        
        keyboard = [
            [InlineKeyboardButton("üìÖ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", callback_data="back_to_schedule")],
            [InlineKeyboardButton("‚úÇÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è", callback_data="start_booking")]
        ]
        
        await query.edit_message_text(
            message,
            reply_markup=InlineKeyboardMarkup(keyboard),
            parse_mode="Markdown"
        )

class SlotNotificationSystem:
    def __init__(self, database):
        self.db = database
        self.waiting_list = {}
        self.scheduler = BackgroundScheduler()
        self.scheduler.start()
        self.setup_periodic_checks()
    
    def setup_periodic_checks(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫"""
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
        self.scheduler.add_job(
            self.check_waiting_list,
            'interval',
            minutes=30
        )
        
        # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π —Ä–∞–∑ –≤ –¥–µ–Ω—å
        self.scheduler.add_job(
            self.cleanup_old_requests,
            'cron',
            hour=3,
            minute=0
        )
    
    async def add_to_waiting_list(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è"""
        query = update.callback_query
        await query.answer()
        
        user_id = query.from_user.id
        master = query.data.replace("wait_slot_", "")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
        self.waiting_list[user_id] = {
            "master": master,
            "added_at": datetime.datetime.now(),
            "notified": False,
            "user_name": query.from_user.first_name
        }
        
        # –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
        await self.check_user_slots(user_id)
        
        await query.edit_message_text(
            f"üîî *–í—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è!*\n\n"
            f"–ú—ã —É–≤–µ–¥–æ–º–∏–º –≤–∞—Å, –∫–æ–≥–¥–∞ —É *{master}* –ø–æ—è–≤–∏—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è.\n\n"
            f"‚ö° –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç!\n"
            f"üìß –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏–¥–µ—Ç –ø—Ä—è–º–æ –≤ —ç—Ç–æ—Ç —á–∞—Ç.",
            parse_mode="Markdown"
        )
    
    async def check_user_slots(self, user_id):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if user_id not in self.waiting_list:
            return
        
        request = self.waiting_list[user_id]
        master = request["master"]
        
        if request["notified"]:
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–∏–∂–∞–π—à–∏–µ 3 –¥–Ω—è
        for days_ahead in range(0, 4):
            check_date = (datetime.datetime.now() + datetime.timedelta(days=days_ahead)).strftime("%Y-%m-%d")
            available_times = booking_system.generate_available_times(check_date, master)
            
            if available_times:
                await self.notify_user_about_slots(user_id, check_date, available_times, master)
                request["notified"] = True
                break
    
    async def check_waiting_list(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–≥–æ —Å–ø–∏—Å–∫–∞ –æ–∂–∏–¥–∞–Ω–∏—è"""
        print(f"üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–∏—Å–∫–∞ –æ–∂–∏–¥–∞–Ω–∏—è: {len(self.waiting_list)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
        
        for user_id in list(self.waiting_list.keys()):
            await self.check_user_slots(user_id)
    
    async def notify_user_about_slots(self, user_id, date, times, master):
        """–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            
            date_display = datetime.datetime.strptime(date, "%Y-%m-%d").strftime("%d.%m.%Y")
            times_sample = ", ".join(times[:5])
            
            message = (
                f"üéâ *–ü–æ—è–≤–∏–ª–æ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è!*\n\n"
                f"–£ *{master}* –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã:\n"
                f"üìÖ *–î–∞—Ç–∞:* {date_display}\n"
                f"‚è∞ *–î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è:* {times_sample}\n\n"
                f"‚ö° –£—Å–ø–µ–π—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è, –ø–æ–∫–∞ –º–µ—Å—Ç–∞ —Å–≤–æ–±–æ–¥–Ω—ã!"
            )
            
            keyboard = [
                [InlineKeyboardButton("‚úèÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è —Å–µ–π—á–∞—Å", callback_data=f"quick_book_{master}")],
                [InlineKeyboardButton("‚ùå –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π", callback_data=f"unsubscribe_slots")]
            ]
            
            await app.bot.send_message(
                chat_id=user_id,
                text=message,
                reply_markup=InlineKeyboardMarkup(keyboard),
                parse_mode="Markdown"
            )
            
            print(f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}")
            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞, —É–¥–∞–ª—è–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞
            if "bot was blocked" in str(e).lower():
                if user_id in self.waiting_list:
                    del self.waiting_list[user_id]
    
    async def unsubscribe_user(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û—Ç–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
        query = update.callback_query
        await query.answer()
        
        user_id = query.from_user.id
        
        if user_id in self.waiting_list:
            master = self.waiting_list[user_id]["master"]
            del self.waiting_list[user_id]
            
            await query.edit_message_text(
                f"üîï *–í—ã –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π*\n\n"
                f"–ë–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ–º —É–≤–µ–¥–æ–º–ª—è—Ç—å –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö —É *{master}*.",
                parse_mode="Markdown"
            )
        else:
            await query.edit_message_text(
                "‚ÑπÔ∏è –í—ã –Ω–µ –±—ã–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö.",
                parse_mode="Markdown"
            )
    
    def cleanup_old_requests(self):
        """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)"""
        current_time = datetime.datetime.now()
        users_to_remove = []
        
        for user_id, request in self.waiting_list.items():
            if (current_time - request['added_at']).days > 7:
                users_to_remove.append(user_id)
        
        for user_id in users_to_remove:
            del self.waiting_list[user_id]
        
        if users_to_remove:
            print(f"üßπ –û—á–∏—â–µ–Ω–æ {len(users_to_remove)} —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–∂–∏–¥–∞–Ω–∏—è")

class EnhancedNotificationSystem:
    def __init__(self):
        self.scheduler = BackgroundScheduler()
        self.scheduler.start()
        self.setup_reminders()
    
    def setup_reminders(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
        # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –≤ 8:00
        self.scheduler.add_job(
            self.send_daily_report,
            'cron',
            hour=8,
            minute=0
        )
        
        # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å
        self.scheduler.add_job(
            self.send_reminders,
            'cron',
            hour='*',
            minute=0
        )
    
    async def send_daily_report(self):
        """–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            today = datetime.datetime.now().strftime("%Y-%m-%d")
            appointments = db.get_daily_appointments(today)
            
            if appointments:
                report = f"üìä *–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –Ω–∞ {today}*\n\n"
                
                # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º
                master_stats = {}
                total_revenue = 0
                
                for app in appointments:
                    master = app[3]
                    if master not in master_stats:
                        master_stats[master] = []
                    master_stats[master].append(app)
                    total_revenue += app[6]  # price
                
                for master, apps in master_stats.items():
                    report += f"üë®‚Äçüíº *{master}:* {len(apps)} –∑–∞–ø–∏—Å–µ–π\n"
                    for app in apps[:3]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 –∑–∞–ø–∏—Å–∏
                        client_name = app[10] if len(app) > 10 else "–ö–ª–∏–µ–Ω—Ç"
                        report += f"   ‚è∞ {app[5]} - {app[2]} ({client_name})\n"
                    report += "\n"
                
                report += f"üìà *–ò—Ç–æ–≥–æ:* {len(appointments)} –∑–∞–ø–∏—Å–µ–π, {total_revenue}‚ÇΩ"
                
            else:
                report = f"üìä *–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç –Ω–∞ {today}*\n\nüì≠ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç"
            
            await app.bot.send_message(
                chat_id=CONFIG['admin_id'],
                text=report,
                parse_mode="Markdown"
            )
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞: {e}")
    
    async def send_reminders(self):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–ø–∏—Å—è—Ö"""
        try:
            app = Application.builder().token(CONFIG["token"]).build()
            current_time = datetime.datetime.now()
            
            # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 24 —á–∞—Å–∞
            tomorrow = (current_time + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
            tomorrow_appointments = db.get_daily_appointments(tomorrow)
            
            for appointment in tomorrow_appointments:
                if not appointment[9]:  # reminder_sent = False
                    await self.send_single_reminder(appointment, "24h", app)
            
            # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 3 —á–∞—Å–∞ (–Ω–∞ —Å–µ–≥–æ–¥–Ω—è)
            today = current_time.strftime("%Y-%m-%d")
            today_appointments = db.get_daily_appointments(today)
            
            for appointment in today_appointments:
                if not appointment[9]:
                    appointment_time = datetime.datetime.strptime(appointment[5], "%H:%M").time()
                    current_time_only = current_time.time()
                    
                    # –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º–µ–Ω–∏
                    time_diff = (datetime.datetime.combine(datetime.date.today(), appointment_time) - 
                               datetime.datetime.combine(datetime.date.today(), current_time_only))
                    
                    if 2.5 <= time_diff.total_seconds() / 3600 <= 3.5:
                        await self.send_single_reminder(appointment, "3h", app)
                        
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π: {e}")
    
    async def send_single_reminder(self, appointment, reminder_type, app):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è"""
        try:
            user_id = appointment[1]
            service = appointment[2]
            master = appointment[3]
            date = appointment[4]
            time = appointment[5]
            
            date_display = datetime.datetime.strptime(date, "%Y-%m-%d").strftime("%d.%m.%Y")
            
            if reminder_type == "24h":
                message = (
                    f"üîî *–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–ø–∏—Å–∏*\n\n"
                    f"–ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞ —É –≤–∞—Å –∑–∞–ø–∏—Å—å:\n"
                    f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞:* {service}\n"
                    f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä:* {master}\n"
                    f"üìÖ *–î–∞—Ç–∞:* {date_display}\n"
                    f"‚è∞ *–í—Ä–µ–º—è:* {time}\n\n"
                    f"üìû *–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–∏–∑–∏—Ç:* +7 (999) 123-45-67"
                )
            else:  # 3h
                message = (
                    f"‚è∞ *–°–∫–æ—Ä–æ –≤—Å—Ç—Ä–µ—á–∞!*\n\n"
                    f"–ß–µ—Ä–µ–∑ 3 —á–∞—Å–∞ —É –≤–∞—Å –∑–∞–ø–∏—Å—å:\n"
                    f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞:* {service}\n"
                    f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä:* {master}\n"
                    f"‚è∞ *–í—Ä–µ–º—è:* {time}\n\n"
                    f"üìç *–ê–¥—Ä–µ—Å:* —É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, 123\n"
                    f"üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* +7 (999) 123-45-67\n\n"
                    f"üí° *–ù–µ –æ–ø–∞–∑–¥—ã–≤–∞–π—Ç–µ!*"
                )
            
            await app.bot.send_message(
                chat_id=user_id,
                text=message,
                parse_mode="Markdown"
            )
            
            # –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ
            cursor = db.conn.cursor()
            cursor.execute('UPDATE appointments SET reminder_sent = TRUE WHERE id = ?', (appointment[0],))
            db.conn.commit()
            
            print(f"‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ {reminder_type} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: {e}")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º
schedule_viewer = ScheduleViewer()
slot_notifier = SlotNotificationSystem(db)
notification_system = EnhancedNotificationSystem()

print("‚úÖ –í—Å–µ Mini-Apps –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –±–µ–∑ –∑–∞–≥–ª—É—à–µ–∫!")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 8: –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–ß–ò–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ë–ï–ó –ó–ê–ì–õ–£–®–ï–ö
async def handle_quick_booking(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∏–ª–∏ –∫–æ–º–∞–Ω–¥–µ"""
    user_id = update.effective_user.id
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏
    if context.args and len(context.args) > 0:
        quick_data = " ".join(context.args)
        
        # –§–æ—Ä–º–∞—Ç—ã: 
        # /start master_–ê–Ω–Ω–∞
        # /start service_—Å—Ç—Ä–∏–∂–∫–∞
        # /start master_–ê–Ω–Ω–∞_service_—Å—Ç—Ä–∏–∂–∫–∞
        
        master = None
        service = None
        
        if "master_" in quick_data and "service_" in quick_data:
            try:
                master_part = quick_data.split("master_")[1].split(" ")[0]
                service_part = quick_data.split("service_")[1].split(" ")[0]
                
                if "_" in master_part:
                    master = master_part.split("_")[0]
                else:
                    master = master_part
                    
                if "_" in service_part:
                    service = service_part.split("_")[0]
                else:
                    service = service_part
                    
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ —Ä–∞–∑–±–æ—Ä–∞ –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏: {e}")
        
        elif "master_" in quick_data:
            try:
                master = quick_data.split("master_")[1].split(" ")[0]
                if "_" in master:
                    master = master.split("_")[0]
            except:
                pass
                
        elif "service_" in quick_data:
            try:
                service = quick_data.split("service_")[1].split(" ")[0]
                if "_" in service:
                    service = service.split("_")[0]
            except:
                pass
        
        # –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –º–∞—Å—Ç–µ—Ä–∞ –∏/–∏–ª–∏ —É—Å–ª—É–≥—É - –Ω–∞—á–∏–Ω–∞–µ–º –±—ã—Å—Ç—Ä—É—é –∑–∞–ø–∏—Å—å
        if master or service:
            booking_system.user_sessions[user_id] = {}
            
            if master and master in CONFIG["masters"]:
                booking_system.user_sessions[user_id]["master"] = master
                
            if service and service in CONFIG["services"]:
                booking_system.user_sessions[user_id]["service"] = service
            
            session = booking_system.user_sessions[user_id]
            
            if "service" in session and "master" in session:
                # –ï—Å—Ç—å –∏ —É—Å–ª—É–≥–∞ –∏ –º–∞—Å—Ç–µ—Ä - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                await update.message.reply_text(
                    f"‚ö° *–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å!*\n\n"
                    f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞:* {session['service']}\n"
                    f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä:* {session['master']}\n\n"
                    f"*–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:*",
                    reply_markup=booking_system.get_enhanced_calendar_keyboard(),
                    parse_mode="Markdown"
                )
                return
            elif "service" in session:
                # –¢–æ–ª—å–∫–æ —É—Å–ª—É–≥–∞ - –≤—ã–±–∏—Ä–∞–µ–º –º–∞—Å—Ç–µ—Ä–∞
                await update.message.reply_text(
                    f"‚ö° *–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å!*\n\n"
                    f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞:* {session['service']}\n\n"
                    f"*–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞:*",
                    reply_markup=booking_system.get_master_keyboard(session['service']),
                    parse_mode="Markdown"
                )
                return
            elif "master" in session:
                # –¢–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä - –≤—ã–±–∏—Ä–∞–µ–º —É—Å–ª—É–≥—É
                await update.message.reply_text(
                    f"‚ö° *–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å!*\n\n"
                    f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä:* {session['master']}\n\n"
                    f"*–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:*",
                    reply_markup=booking_system.get_service_keyboard(),
                    parse_mode="Markdown"
                )
                return
    
    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ - –≤—ã–±–æ—Ä —Ä–æ–ª–∏
    await role_system.show_role_selection(update, context)

async def handle_calendar_page(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –∫–∞–ª–µ–Ω–¥–∞—Ä—è"""
    query = update.callback_query
    await query.answer()
    
    page = int(query.data.replace("calendar_page_", ""))
    user_id = query.from_user.id
    
    session = booking_system.user_sessions.get(user_id, {})
    
    await query.edit_message_text(
        f"üìÖ *–í—ã–±–æ—Ä –¥–∞—Ç—ã* (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ {page + 1})\n\n"
        f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞:* {session.get('service', '–Ω–µ –≤—ã–±—Ä–∞–Ω–∞')}\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä:* {session.get('master', '–Ω–µ –≤—ã–±—Ä–∞–Ω')}\n\n"
        f"*–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:*",
        reply_markup=booking_system.get_enhanced_calendar_keyboard(page),
        parse_mode="Markdown"
    )

async def handle_today_date(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã"""
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    today = datetime.datetime.now().strftime("%Y-%m-%d")
    
    if user_id not in booking_system.user_sessions:
        await query.edit_message_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.")
        return
    
    booking_system.user_sessions[user_id]["date"] = today
    
    date_display = datetime.datetime.now().strftime("%d.%m.%Y")
    master = booking_system.user_sessions[user_id]["master"]
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
    time_keyboard = booking_system.get_time_keyboard(today, master)
    
    if not time_keyboard:
        # –ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
        await query.edit_message_text(
            f"üòî *–ù–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤*\n\n"
            f"–£ *{master}* –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.\n\n"
            f"–í—ã –º–æ–∂–µ—Ç–µ:\n"
            f"‚Ä¢ üîî –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–ª–æ—Ç–æ–≤\n"
            f"‚Ä¢ üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞\n"
            f"‚Ä¢ üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É",
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("üîî –£–≤–µ–¥–æ–º–∏—Ç—å –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö", callback_data=f"wait_slot_{master}")],
                [InlineKeyboardButton("üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞", callback_data="back_to_masters")],
                [InlineKeyboardButton("üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É", callback_data="back_to_calendar")]
            ]),
            parse_mode="Markdown"
        )
        return
    
    await query.edit_message_text(
        f"‚úÇÔ∏è *{booking_system.user_sessions[user_id]['service']}*\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä: {master}*\n"
        f"üìÖ *–î–∞—Ç–∞: {date_display} (–°–µ–≥–æ–¥–Ω—è)*\n\n"
        f"*–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è:*",
        reply_markup=time_keyboard,
        parse_mode="Markdown"
    )

async def handle_time_selection(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π"""
    query = update.callback_query
    await query.answer()
    
    # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
    if query.data == "time_header":
        return
    
    time_str = query.data.replace("time_", "")
    user_id = query.from_user.id
    
    if user_id not in booking_system.user_sessions:
        await query.edit_message_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.")
        return
    
    session = booking_system.user_sessions[user_id]
    session["time"] = time_str
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
    is_valid, message = validation_system.validate_booking_time(
        session['date'], session['time'], session['master']
    )
    
    if not is_valid:
        await query.edit_message_text(message)
        return
    
    date_display = datetime.datetime.strptime(session["date"], "%Y-%m-%d").strftime("%d.%m.%Y")
    price = CONFIG["services"][session["service"]]
    
    confirmation_text = (
        f"‚úÖ *–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ó–ê–ü–ò–°–ò*\n\n"
        f"‚úÇÔ∏è *–£—Å–ª—É–≥–∞:* {session['service']}\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä:* {session['master']}\n"
        f"üìÖ *–î–∞—Ç–∞:* {date_display}\n"
        f"‚è∞ *–í—Ä–µ–º—è:* {time_str}\n"
        f"üí∞ *–°—Ç–æ–∏–º–æ—Å—Ç—å:* {price}‚ÇΩ\n\n"
        f"üìç *–ê–¥—Ä–µ—Å:* —É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, 123\n"
        f"üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* +7 (999) 123-45-67\n\n"
        f"–í—Å—ë –≤–µ—Ä–Ω–æ?"
    )
    
    keyboard = [
        [InlineKeyboardButton("‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å", callback_data="confirm_yes"),
         InlineKeyboardButton("‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è", callback_data="back_to_times")],
        [InlineKeyboardButton("üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", callback_data="restart")]
    ]
    
    await query.edit_message_text(
        confirmation_text,
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )

async def handle_quick_book(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""
    query = update.callback_query
    await query.answer()
    
    master = query.data.replace("quick_book_", "")
    user_id = query.from_user.id
    
    # –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –º–∞—Å—Ç–µ—Ä–æ–º
    booking_system.user_sessions[user_id] = {"master": master}
    
    await query.edit_message_text(
        f"‚ö° *–ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å –∫ {master}*\n\n"
        f"*–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:*",
        reply_markup=booking_system.get_service_keyboard(),
        parse_mode="Markdown"
    )

async def handle_no_slots_scenario(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤"""
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    session = booking_system.user_sessions.get(user_id, {})
    
    master = session.get('master', '–º–∞—Å—Ç–µ—Ä')
    
    await query.edit_message_text(
        f"üòî *–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤*\n\n"
        f"–£ *{master}* –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.\n\n"
        f"üí° *–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:*\n"
        f"‚Ä¢ üîî –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–ª–æ—Ç–æ–≤\n"
        f"‚Ä¢ üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞\n"
        f"‚Ä¢ üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É\n"
        f"‚Ä¢ üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞–º –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è",
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("üîî –£–≤–µ–¥–æ–º–∏—Ç—å –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö", callback_data=f"wait_slot_{master}")],
            [InlineKeyboardButton("üîÑ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞", callback_data="back_to_masters")],
            [InlineKeyboardButton("üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É", callback_data="back_to_calendar")],
            [InlineKeyboardButton("üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å", callback_data="call_salon")]
        ]),
        parse_mode="Markdown"
    )

async def handle_call_salon(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –∑–≤–æ–Ω–∫–∞ –≤ —Å–∞–ª–æ–Ω"""
    query = update.callback_query
    await query.answer()
    
    await query.edit_message_text(
        "üìû *–ö–æ–Ω—Ç–∞–∫—Ç—ã —Å–∞–ª–æ–Ω–∞:*\n\n"
        "–¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67\n"
        "–ê–¥—Ä–µ—Å: —É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, 123\n"
        "–ì—Ä–∞—Ñ–∏–∫: 9:00-21:00, –±–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö\n\n"
        "üí° *–ó–≤–æ–Ω–∏—Ç–µ, –º—ã –ø–æ–º–æ–∂–µ–º –ø–æ–¥–æ–±—Ä–∞—Ç—å —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è!*",
        parse_mode="Markdown"
    )

async def handle_back_to_times(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É –≤—Ä–µ–º–µ–Ω–∏"""
    query = update.callback_query
    await query.answer()
    
    user_id = query.from_user.id
    session = booking_system.user_sessions.get(user_id, {})
    
    if not session or 'date' not in session or 'master' not in session:
        await query.edit_message_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.")
        return
    
    date_str = session['date']
    master = session['master']
    date_display = datetime.datetime.strptime(date_str, "%Y-%m-%d").strftime("%d.%m.%Y")
    
    time_keyboard = booking_system.get_time_keyboard(date_str, master)
    
    if not time_keyboard:
        await handle_no_slots_scenario(update, context)
        return
    
    await query.edit_message_text(
        f"‚úÇÔ∏è *{session['service']}*\n"
        f"üë®‚Äçüíº *–ú–∞—Å—Ç–µ—Ä: {master}*\n"
        f"üìÖ *–î–∞—Ç–∞: {date_display}*\n\n"
        f"*–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è:*",
        reply_markup=time_keyboard,
        parse_mode="Markdown"
    )

# –û–ë–ù–û–í–õ–Ø–ï–ú —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π

# –ó–∞–º–µ–Ω—è–µ–º handle_time –Ω–∞ handle_time_selection
# –ó–∞–º–µ–Ω—è–µ–º start –Ω–∞ handle_quick_booking

print("‚úÖ –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–µ –±–µ–∑ –∑–∞–≥–ª—É—à–µ–∫!")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 9: –ü–û–õ–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø –ë–ï–ó –ó–ê–ì–õ–£–®–ï–ö
def setup_complete_application():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ –≤—Å–µ–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏"""
    application = Application.builder().token(CONFIG["token"]).build()
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
    application.add_handler(CommandHandler("start", handle_quick_booking))
    application.add_handler(CommandHandler("mybookings", my_bookings))
    application.add_handler(CommandHandler("schedule", schedule_viewer.quick_schedule))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã —Ä–æ–ª–µ–π
    application.add_handler(CallbackQueryHandler(role_system.handle_role_selection, pattern="^role_"))
    application.add_handler(CallbackQueryHandler(role_system.show_admin_menu, pattern="^admin_"))
    application.add_handler(CallbackQueryHandler(role_system.show_master_menu, pattern="^master_"))
    application.add_handler(CallbackQueryHandler(role_system.show_client_menu, pattern="^client_"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø–∏—Å–∏
    application.add_handler(CallbackQueryHandler(handle_service, pattern="^service_"))
    application.add_handler(CallbackQueryHandler(handle_master, pattern="^master_"))
    application.add_handler(CallbackQueryHandler(handle_date, pattern="^date_"))
    application.add_handler(CallbackQueryHandler(handle_time_selection, pattern="^time_"))
    application.add_handler(CallbackQueryHandler(handle_confirmation, pattern="^confirm_"))
    application.add_handler(CallbackQueryHandler(cancel_booking, pattern="^cancel_"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    application.add_handler(CallbackQueryHandler(handle_calendar_page, pattern="^calendar_page_"))
    application.add_handler(CallbackQueryHandler(handle_today_date, pattern="^date_today$"))
    application.add_handler(CallbackQueryHandler(handle_back_to_times, pattern="^back_to_times$"))
    application.add_handler(CallbackQueryHandler(handle_service, pattern="^back_to_services$"))
    application.add_handler(CallbackQueryHandler(handle_master, pattern="^back_to_masters$"))
    application.add_handler(CallbackQueryHandler(handle_date, pattern="^back_to_calendar$"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Mini-Apps
    application.add_handler(CallbackQueryHandler(schedule_viewer.quick_schedule, pattern="^quick_schedule$"))
    application.add_handler(CallbackQueryHandler(schedule_viewer.quick_schedule, pattern="^back_to_schedule$"))
    application.add_handler(CallbackQueryHandler(schedule_viewer.show_tomorrow_schedule, pattern="^schedule_tomorrow$"))
    application.add_handler(CallbackQueryHandler(schedule_viewer.show_master_schedule, pattern="^view_master_schedule_"))
    application.add_handler(CallbackQueryHandler(schedule_viewer.show_tomorrow_master_schedule, pattern="^view_tomorrow_master_"))
    application.add_handler(CallbackQueryHandler(schedule_viewer.show_all_masters, pattern="^view_all_masters$"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    application.add_handler(CallbackQueryHandler(slot_notifier.add_to_waiting_list, pattern="^wait_slot_"))
    application.add_handler(CallbackQueryHandler(slot_notifier.unsubscribe_user, pattern="^unsubscribe_slots$"))
    application.add_handler(CallbackQueryHandler(handle_quick_book, pattern="^quick_book_"))
    application.add_handler(CallbackQueryHandler(handle_no_slots_scenario, pattern="^no_slots_"))
    application.add_handler(CallbackQueryHandler(handle_call_salon, pattern="^call_salon$"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
    application.add_handler(CallbackQueryHandler(handle_quick_booking, pattern="^restart$"))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    application.add_error_handler(error_handler.handle_error)
    
    return application

async def run_complete_bot():
    """–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞"""
    application = setup_complete_application()
    
    print("=" * 60)
    print("ü§ñ BARBERPRO SYSTEM - –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø")
    print("‚úÖ –í—Å–µ —Å–∏—Å—Ç–µ–º—ã –∞–∫—Ç–∏–≤–Ω—ã")
    print("‚úÖ –ó–∞–≥–ª—É—à–∫–∏ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω—ã") 
    print("‚úÖ Mini-Apps —Ä–∞–±–æ—Ç–∞—é—Ç")
    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞")
    print("‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã")
    print("=" * 60)
    
    await application.run_polling()

def start_complete_system():
    """–ó–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã —Å –∞–≤—Ç–æ-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º"""
    max_retries = 10
    retry_delay = 5
    
    for attempt in range(max_retries):
        try:
            print(f"üöÄ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞ #{attempt + 1}")
            asyncio.run(run_complete_bot())
        except KeyboardInterrupt:
            print("\nüõë –°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
            break
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {e}")
            if attempt < max_retries - 1:
                wait_time = retry_delay * (attempt + 1)
                print(f"‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ {wait_time} —Å–µ–∫—É–Ω–¥...")
                time.sleep(wait_time)
            else:
                print("üö® –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å")
                break

print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!")python–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å# –ë–õ–û–ö 10: –§–ò–ù–ê–õ–¨–ù–´–ô –ó–ê–ü–£–°–ö
if __name__ == '__main__':
    print("üéâ –ó–ê–ü–£–°–ö –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–ß–ï–ô –°–ò–°–¢–ï–ú–´ BARBERPRO!")
    print("üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤...")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    try:
        cursor = db.conn.cursor()
        cursor.execute('SELECT COUNT(*) FROM appointments')
        appointment_count = cursor.fetchone()[0]
        print(f"üìä –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: {appointment_count} –∑–∞–ø–∏—Å–µ–π")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {e}")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    print(f"üëë –ê–¥–º–∏–Ω: {CONFIG['admin_id']}")
    print(f"üë®‚Äçüíº –ú–∞—Å—Ç–µ—Ä–∞: {len(CONFIG['masters'])}")
    print(f"‚úÇÔ∏è –£—Å–ª—É–≥–∏: {len(CONFIG['services'])}")
    print(f"üïí –ì—Ä–∞—Ñ–∏–∫: {CONFIG['working_hours']['start']}-{CONFIG['working_hours']['end']}")
    
    # –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
    print("\nüöÄ –ó–ê–ü–£–°–ö–ê–ï–ú –°–ò–°–¢–ï–ú–£...")
    start_complete_system()üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–°: –í–°–ï –ó–ê–ì–õ–£–®–ö–ò –õ–ò–ö–í–ò–î–ò–†–û–í–ê–ù–´!‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ:üéØ –£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–∏:–ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞ 4 –∫–ª–∏–∫–∞–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–∞—Ç–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–ª–æ—Ç–æ–≤–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—èüìä –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ Mini-Apps:–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –∑–∞–≤—Ç—Ä–∞–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–æ—Ç–æ–≤ –ø–æ –º–∞—Å—Ç–µ—Ä–∞–º–°–∏—Å—Ç–µ–º–∞ –æ–∂–∏–¥–∞–Ω–∏—è —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º –¥–Ω—èüîî –£–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 24 –∏ 3 —á–∞—Å–∞–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–∞—Ö–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø–∏—Å–∫–∞üìÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å:–ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–∞ 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã–í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏–ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏‚ö° –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è:–ì–ª—É–±–æ–∫–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é–£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ãüöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:bash–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å–°–∫–∞—á–∞—Ç—å/start - –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –≥–ª—É–±–æ–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
/start master_–ê–Ω–Ω–∞ - –ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å –∫ –ê–Ω–Ω–µ
/start service_—Å—Ç—Ä–∏–∂–∫–∞ - –ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É
/mybookings - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏
/schedule - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—èüéä –†–ï–ó–£–õ–¨–¢–ê–¢:–í–°–ï –ó–ê–ì–õ–£–®–ö–ò –ü–û–õ–ù–û–°–¢–¨–Æ –õ–ò–ö–í–ò–î–ò–†–û–í–ê–ù–´!–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞—Ä–±–µ—Ä—à–æ–ø–æ–º —Å:‚úÖ –ü–æ–ª–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∑–∞–ø–∏—Å–∏‚úÖ –£–º–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –æ—Ç—á–µ—Ç–∞–º–∏‚úÖ –°–∏—Å—Ç–µ–º–æ–π –æ–∂–∏–¥–∞–Ω–∏—è —Å–ª–æ—Ç–æ–≤‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –æ–ø—ã—Ç–æ–º–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏! üéâ