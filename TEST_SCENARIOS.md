# üß™ TEST SCENARIOS & EXAMPLES | salon_bot.py

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
```
1. –í—Å–µ —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∫–∞–∫ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. –ú–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è pytest –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ Telegram —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–æ—Ç–æ–º
```

---

## üì± –†–£–ß–ù–´–ï –¢–ï–°–¢–´ –î–õ–Ø TELEGRAM

### üü¢ –¢–ï–°–¢ 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø–∏—Å–∏ (Client ‚Üí Booking)

**–®–∞–≥–∏:**
```
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å /start
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å —É—Å–ª—É–≥–∞–º–∏
   ‚ùå –§–ê–ö–¢–ò–ß–ï–°–ö–ò: ?

2. –ù–∞–∂–∞—Ç—å "‚úÇÔ∏è –ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞"
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω—ã –º–∞—Å—Ç–µ—Ä–∞
   ‚ùå –§–ê–ö–¢–ò–ß–ï–°–ö–ò: ?

3. –í—ã–±—Ä–∞—Ç—å –º–∞—Å—Ç–µ—Ä–∞ "–î–º–∏—Ç—Ä–∏–π"
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω –∫–∞–ª–µ–Ω–¥–∞—Ä—å
   ‚ùå –§–ê–ö–¢–ò–ß–ï–°–ö–ò: ?

4. –í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É (—Å–µ–≥–æ–¥–Ω—è + 2 –¥–Ω—è)
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω—ã —Å–≤–æ–±–æ–¥–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞
   ‚ùå –§–ê–ö–¢–ò–ß–ï–°–ö–ò: ?

5. –í—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è "10:00"
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏
   ‚ùå –§–ê–ö–¢–ò–ß–ï–°–ö–ò: ?

6. –ù–∞–∂–∞—Ç—å "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: "–ó–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞! ID: booking_..."
   ‚ùå –§–ê–ö–¢–ò–ß–ï–°–ö–ò: ?

7. –û—Ç–ø—Ä–∞–≤–∏—Ç—å /mybookings
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å
   ‚ùå –§–ê–ö–¢–ò–ß–ï–°–ö–ò: ?
```

---

### üü† –¢–ï–°–¢ 2: –ó–∞–ø–∏—Å—å –≤ –ø—Ä–æ—à–ª–æ–µ (Validation Check)

**–®–∞–≥–∏:**
```
1. /start ‚Üí –í—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥—É ‚Üí –í—ã–±—Ä–∞—Ç—å –º–∞—Å—Ç–µ—Ä–∞
   
2. –í –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –Ω–∞–∂–∞—Ç—å –Ω–∞ –¥–∞—Ç—É –í–´–ß–ï –°–ï–ì–û–î–ù–Ø (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
   ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –°–∏—Å—Ç–µ–º–∞ –ù–ï –¥–æ–ª–∂–Ω–∞ –ø–æ–∑–≤–æ–ª–∏—Ç—å —ç—Ç–æ!
   ‚ùå –û–ñ–ò–î–ê–ï–ú–û: –î–∞—Ç–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (üî¥ –∏–ª–∏ –Ω–µ –≤–∏–¥–Ω–∞)
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –¥–∞—Ç–∞ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ ‚Üí BUG!
```

**–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è –∫–æ–ª–ª–µ–≥):**
```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å generate_available_times():
date_str = "2024-01-10"  # –î–∞—Ç–∞ –≤ –ø—Ä–æ—à–ª–æ–º
available = ultra_calendar.generate_available_times(date_str, "–î–º–∏—Ç—Ä–∏–π")

if len(available) > 0:
    print("‚ùå BUG: –ü—Ä–æ—à–ª–∞—è –¥–∞—Ç–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã!")
else:
    print("‚úÖ OK: –ü—Ä–æ—à–ª–∞—è –¥–∞—Ç–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞")
```

---

### üü† –¢–ï–°–¢ 3: –ó–∞–ø–∏—Å—å –≤–æ –≤—Ä–µ–º—è –æ–±–µ–¥–∞

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```python
CONFIG["salon_info"]["working_hours"]["lunch"] = ["12:00", "13:00"]
```

**–®–∞–≥–∏:**
```
1. /start ‚Üí –í—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥—É ‚Üí –í—ã–±—Ä–∞—Ç—å –º–∞—Å—Ç–µ—Ä–∞ ‚Üí –í—ã–±—Ä–∞—Ç—å –∑–∞–≤—Ç—Ä–∞—à–Ω—é—é –¥–∞—Ç—É

2. –í —Å–ø–∏—Å–∫–µ –≤—Ä–µ–º—ë–Ω –î–û–õ–ñ–ù–û –û–¢–°–£–¢–°–¢–í–û–í–ê–¢–¨: 12:00, 12:30, 13:00
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ï—Å—Ç—å 11:30, –ø–æ—Ç–æ–º 13:30+ (12:00-13:00 –ø—Ä–æ–ø—É—â–µ–Ω–æ)
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ 12:00 –≤–∏–¥–Ω–æ ‚Üí BUG!
```

**–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```python
tomorrow = (datetime.date.today() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
available = ultra_calendar.generate_available_times(tomorrow, "–î–º–∏—Ç—Ä–∏–π")

lunch_slots = [t for t in available if t.startswith("12") or t == "13:00"]
if lunch_slots:
    print(f"‚ùå BUG: –û–±–µ–¥–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã: {lunch_slots}")
else:
    print("‚úÖ OK: –û–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ")
```

---

### üî¥ –¢–ï–°–¢ 4: Race Condition (–¥–≤–æ–π–Ω–∞—è –∑–∞–ø–∏—Å—å)

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```
–¢–†–ï–ë–£–ï–¢–°–Ø: 2 –£–°–¢–†–û–ô–°–¢–í–ê –∏–ª–∏ 2 –ê–ö–ö–ê–£–ù–¢–ê Telegram

–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ A:                    | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ B:
1. /start                        | /start
2. –í—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥—É               | –í—ã–±—Ä–∞—Ç—å —Ç—É –∂–µ —É—Å–ª—É–≥—É
3. –í—ã–±—Ä–∞—Ç—å –º–∞—Å—Ç–µ—Ä–∞              | –í—ã–±—Ä–∞—Ç—å —Ç–æ–≥–æ –∂–µ –º–∞—Å—Ç–µ—Ä–∞
4. –í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É (–∑–∞–≤—Ç—Ä–∞)        | –í—ã–±—Ä–∞—Ç—å —Ç—É –∂–µ –¥–∞—Ç—É
5. –í—ã–±—Ä–∞—Ç—å 10:00                | –í—ã–±—Ä–∞—Ç—å 10:00 (–û–î–ù–û–í–†–ï–ú–ï–ù–ù–û!)
   –°–∏—Å—Ç–µ–º–∞: "–≠—Ç–æ –≤—Ä–µ–º—è —Å–≤–æ–±–æ–¥–Ω–æ" | –°–∏—Å—Ç–µ–º–∞: "–≠—Ç–æ –≤—Ä–µ–º—è —Å–≤–æ–±–æ–¥–Ω–æ"
                                  |
6. –ù–∞–∂–∞—Ç—å "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"         | –ù–∞–∂–∞—Ç—å "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"
   ‚úÖ –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞            | ??? –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç?
                                  |
–ü–†–û–í–ï–†–ö–ê:                        |
- ‚ùå –ï–°–õ–ò –æ–±–µ –∑–∞–ø–∏—Å–∏ —Å–æ–∑–¥–∞–Ω—ã     ‚Üí CRITICAL BUG (race condition)
- ‚úÖ –ï–°–õ–ò –≤—Ç–æ—Ä–∞—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞       ‚Üí OK (–∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```

**–ö–∞–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É:**
```python
# –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –¥–≤–æ–π–Ω–∞—è –∑–∞–ø–∏—Å—å, –≤ logs –±—É–¥–µ—Ç:
same_slots = [b for b in bookings.values() 
              if b['date'] == '2024-01-25' 
              and b['time'] == '10:00' 
              and b['master'] == '–î–º–∏—Ç—Ä–∏–π']

if len(same_slots) > 1:
    print(f"‚ùå RACE CONDITION: {len(same_slots)} –∑–∞–ø–∏—Å–µ–π –Ω–∞ –æ–¥–Ω–æ –≤—Ä–µ–º—è!")
    for b in same_slots:
        print(f"  - {b['id']} (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {b['user_id']})")
```

---

### üü† –¢–ï–°–¢ 5: Web App (Mini-App)

**–®–∞–≥–∏:**
```
1. /start
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üé® –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å (–Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)"
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è https://charodeyka-booking.netlify.app
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Üí URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

3. –í Web App –≤—ã–±—Ä–∞—Ç—å —É—Å–ª—É–≥—É, –º–∞—Å—Ç–µ—Ä–∞, –¥–∞—Ç—É, –≤—Ä–µ–º—è
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ö—Ä–∞—Å–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç–∞–µ—Ç
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å URL

4. –ù–∞–∂–∞—Ç—å "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"
   ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: 
   - –ü—Ä–æ–∏–∑–æ–π–¥—ë—Ç –õ–ò —á—Ç–æ-—Ç–æ? –í–µ—Ä–Ω—ë—Ç–µ—Å—å –ª–∏ –≤—ã –≤ Telegram?
   - –ü–æ—è–≤–∏—Ç—Å—è –õ–ò –∑–∞–ø–∏—Å—å –≤ /mybookings?
   - ‚ùå –ï–°–õ–ò –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç ‚Üí WEB APP –ù–ï –†–ê–ë–û–¢–ê–ï–¢!

5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å /mybookings
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ó–∞–ø–∏—Å—å –∏–∑ Web App –≤–∏–¥–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –µ—ë –Ω–µ—Ç ‚Üí handler –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
```

**–û—Ç–ª–∞–¥–∫–∞:**
```python
# –í salon_bot.py –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
logger.info(f"Web App data received: {data}")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å logs/bot.log:
# –ï—Å–ª–∏ —Ç–∞–º –Ω–∏—á–µ–≥–æ ‚Üí handler –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
# –ï—Å–ª–∏ —Ç–∞–º –∑–∞–ø–∏—Å—å ‚Üí handler —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –∑–∞–ø–∏—Å—å –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è
```

---

### üü¢ –¢–ï–°–¢ 6: –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏

**–®–∞–≥–∏:**
```
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å (—Ç–µ—Å—Ç 1)

2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å /mybookings
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å —Å –∫–Ω–æ–ø–∫–∞–º–∏
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –∫–Ω–æ–ø–æ–∫ –Ω–µ—Ç ‚Üí BUG –≤ my_bookings()

3. –ù–∞–∂–∞—Ç—å "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å"
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: "–ó–∞–ø–∏—Å—å –æ—Ç–º–µ–Ω–µ–Ω–∞" 
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –Ω–µ –æ—Ç–º–µ–Ω–∏–ª–∞—Å—å ‚Üí BUG –≤ handle_management()

4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å /mybookings –µ—â—ë —Ä–∞–∑
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ó–∞–ø–∏—Å—å –ù–ï –≤–∏–¥–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –≤–∏–¥–Ω–∞ ‚Üí status –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è
```

---

### üî¥ –¢–ï–°–¢ 7: –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π

**–ê–¥–º–∏–Ω:**
```
1. –ê–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start (ID = CONFIG['admin_id'])
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –í–∏–¥–∏—Ç –õ–ò –º–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞?
   ‚ùå –ï–°–õ–ò –î–ê:  ‚úÖ OK
   ‚ùå –ï–°–õ–ò –ù–ï–¢: ‚ùå BUG - —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

2. –ê–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /admin
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∞–ª–æ–Ω–∞
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ ‚Üí –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ö–æ—Ä–æ—à–æ)
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ–º ‚Üí –∑–∞—â–∏—Ç–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (BUG)
```

**–ú–∞—Å—Ç–µ—Ä:**
```
1. –ú–∞—Å—Ç–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start (ID –∏–∑ CONFIG['masters'].values())
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –í–∏–¥–∏—Ç –õ–ò –º–µ–Ω—é –º–∞—Å—Ç–µ—Ä–∞?
   ‚ùå –ï–°–õ–ò –î–ê:  ‚úÖ OK
   ‚ùå –ï–°–õ–ò –ù–ï–¢: ‚ùå BUG - —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

2. –ú–∞—Å—Ç–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /master
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –ü–æ–∫–∞–∑–∞–Ω–æ –ª–∏—á–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ ‚Üí –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ö–æ—Ä–æ—à–æ)
```

**–ö–ª–∏–µ–Ω—Ç:**
```
1. –ö–ª–∏–µ–Ω—Ç (–¥—Ä—É–≥–æ–π ID) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: –í–∏–¥–∏—Ç –º–µ–Ω—é –∫–ª–∏–µ–Ω—Ç–∞ (–≤—ã–±–æ—Ä —É—Å–ª—É–≥–∏)
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –≤–∏–¥–∏—Ç –º–µ–Ω—é –∞–¥–º–∏–Ω–∞/–º–∞—Å—Ç–µ—Ä–∞ ‚Üí BUG

2. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /admin
   ‚úÖ –û–ñ–ò–î–ê–ï–ú–û: "‚ùå –≠—Ç–æ –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
   ‚ùå –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∞ ‚Üí –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –£–Ø–ó–í–ò–ú–û–°–¢–¨!
```

---

## üíª PYTHON UNIT TESTS (pytest)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
pip install pytest pytest-asyncio
```

---

### Test File: `test_validation.py`

```python
import pytest
from salon_bot import validation, ValidationSystem
import datetime

class TestValidationSystem:
    
    def test_valid_future_time(self):
        """–¢–µ—Å—Ç: –≤–∞–ª–∏–¥–Ω–æ–µ –≤—Ä–µ–º—è –≤ –±—É–¥—É—â–µ–º"""
        tomorrow = (datetime.date.today() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        is_valid, msg = validation.validate_booking_time(tomorrow, "10:00", "–î–º–∏—Ç—Ä–∏–π")
        assert is_valid, f"–û—à–∏–±–∫–∞: {msg}"
    
    def test_invalid_past_time(self):
        """–¢–µ—Å—Ç: –≤—Ä–µ–º—è –≤ –ø—Ä–æ—à–ª–æ–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ"""
        yesterday = (datetime.date.today() - datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        is_valid, msg = validation.validate_booking_time(yesterday, "10:00", "–î–º–∏—Ç—Ä–∏–π")
        assert not is_valid, "–ü—Ä–æ—à–ª–∞—è –¥–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞"
        assert "–ø—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è" in msg.lower()
    
    def test_invalid_lunch_time(self):
        """–¢–µ—Å—Ç: –≤—Ä–µ–º—è –æ–±–µ–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"""
        tomorrow = (datetime.date.today() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        is_valid, msg = validation.validate_booking_time(tomorrow, "12:30", "–î–º–∏—Ç—Ä–∏–π")
        assert not is_valid, "–í—Ä–µ–º—è –æ–±–µ–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ"
        assert "–æ–±–µ–¥" in msg.lower()
    
    def test_invalid_nonexistent_master(self):
        """–¢–µ—Å—Ç: –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞—Å—Ç–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω"""
        tomorrow = (datetime.date.today() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        is_valid, msg = validation.validate_booking_time(tomorrow, "10:00", "–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π–ú–∞—Å—Ç–µ—Ä")
        assert not is_valid, "–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–∞—Å—Ç–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω"
    
    def test_valid_times_outside_lunch(self):
        """–¢–µ—Å—Ç: –≤—Ä–µ–º–µ–Ω–∞ –≤–Ω–µ –æ–±–µ–¥–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ–ø—É—Å—Ç–∏–º—ã"""
        tomorrow = (datetime.date.today() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        
        valid_times = ["09:00", "11:30", "13:30", "17:00"]
        for time in valid_times:
            is_valid, msg = validation.validate_booking_time(tomorrow, time, "–î–º–∏—Ç—Ä–∏–π")
            assert is_valid, f"–í—Ä–µ–º—è {time} –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ–ø—É—Å—Ç–∏–º–æ: {msg}"


# –ó–∞–ø—É—Å–∫: pytest test_validation.py -v
```

---

### Test File: `test_booking_logic.py`

```python
import pytest
from salon_bot import bookings, user_sessions, ultra_calendar
import datetime

class TestBookingLogic:
    
    def setup_method(self):
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º"""
        # –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        bookings.clear()
        user_sessions.clear()
    
    def test_available_times_generation(self):
        """–¢–µ—Å—Ç: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–µ–º—ë–Ω"""
        tomorrow = (datetime.date.today() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        available = ultra_calendar.generate_available_times(tomorrow, "–î–º–∏—Ç—Ä–∏–π")
        
        # –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–∞
        assert len(available) > 0, "–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞"
        
        # –ù–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–∞ –æ–±–µ–¥–∞
        lunch_times = [t for t in available if t.startswith("12") or t.startswith("13:00")]
        assert len(lunch_times) == 0, "–û–±–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö"
    
    def test_booked_time_unavailable(self):
        """–¢–µ—Å—Ç: –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ"""
        tomorrow = (datetime.date.today() + datetime.timedelta(days=1)).strftime("%Y-%m-%d")
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∑–∞–ø–∏—Å—å
        bookings['test_booking'] = {
            'date': tomorrow,
            'time': '10:00',
            'master': '–î–º–∏—Ç—Ä–∏–π',
            'status': 'confirmed'
        }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ 10:00 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
        available = ultra_calendar.generate_available_times(tomorrow, "–î–º–∏—Ç—Ä–∏–π")
        assert '10:00' not in available, "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"


# –ó–∞–ø—É—Å–∫: pytest test_booking_logic.py -v
```

---

### Test File: `test_race_condition.py`

```python
import pytest
import asyncio
import threading
from salon_bot import bookings, booking_lock, handle_confirmation
from unittest.mock import AsyncMock, MagicMock

class TestRaceCondition:
    
    def test_booking_lock_exists(self):
        """–¢–µ—Å—Ç: –≥–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"""
        assert booking_lock is not None, "booking_lock –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞"
        assert isinstance(booking_lock, threading.Lock), "booking_lock –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å Lock"
    
    def test_concurrent_bookings(self):
        """–¢–µ—Å—Ç: –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—â–∏–µ –∑–∞–ø–∏—Å—å –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞—Ç—å –¥–≤–æ–π–Ω—É—é –±—Ä–æ–Ω—å"""
        # –≠—Ç–æ—Ç —Ç–µ—Å—Ç —Å–ª–æ–∂–Ω—ã–π - —Ç—Ä–µ–±—É–µ—Ç mock –æ–±—ä–µ–∫—Ç–æ–≤
        # –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:
        
        bookings.clear()
        test_booking = {
            'id': 'test_123',
            'date': '2024-12-25',
            'time': '10:00',
            'master': '–î–º–∏—Ç—Ä–∏–π',
            'status': 'confirmed'
        }
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å
        with booking_lock:
            bookings['test_123'] = test_booking
        
        # –ü—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â—É—é –∑–∞–ø–∏—Å—å
        with booking_lock:
            conflict = any(
                b['date'] == '2024-12-25' and 
                b['time'] == '10:00' and 
                b['master'] == '–î–º–∏—Ç—Ä–∏–π'
                for b in bookings.values()
            )
            assert conflict, "–ö–æ–Ω—Ñ–ª–∏–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω"


# –ó–∞–ø—É—Å–∫: pytest test_race_condition.py -v
```

---

### Test File: `test_role_system.py`

```python
import pytest
from salon_bot import get_user_role, CONFIG

class TestRoleSystem:
    
    def test_admin_role(self):
        """–¢–µ—Å—Ç: –∞–¥–º–∏–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ CONFIG['admin_id']"""
        admin_id = CONFIG['admin_id']
        role = get_user_role(admin_id)
        assert role == 'admin', f"ID {admin_id} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–æ–º"
    
    def test_master_role(self):
        """–¢–µ—Å—Ç: –º–∞—Å—Ç–µ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ CONFIG['masters']"""
        master_ids = list(CONFIG['masters'].values())
        if master_ids:
            role = get_user_role(master_ids[0])
            assert role == 'master', f"ID {master_ids[0]} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Ç–µ—Ä–æ–º"
    
    def test_client_role(self):
        """–¢–µ—Å—Ç: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π ID -> –∫–ª–∏–µ–Ω—Ç"""
        role = get_user_role(999999999)  # –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ID
        assert role == 'client', "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–º"


# –ó–∞–ø—É—Å–∫: pytest test_role_system.py -v
```

---

## üìä –¢–ê–ë–õ–ò–¶–ê –û–ñ–ò–î–ê–ï–ú–´–• –†–ï–ó–£–õ–¨–¢–ê–¢–û–í

| –¢–µ—Å—Ç | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º | OK? | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|---------------|-----|-----------|
| 1 | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø–∏—Å–∏ | ? | –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å |
| 2 | –ó–∞–ø–∏—Å—å –≤ –ø—Ä–æ—à–ª–æ–µ | ? | –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã |
| 3 | –ó–∞–ø–∏—Å—å –≤–æ –≤—Ä–µ–º—è –æ–±–µ–¥–∞ | ? | –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ |
| 4 | Race condition | ? | –ö–†–ò–¢–ò–ß–ù–´–ô! |
| 5 | Web App | ? | –ö–†–ò–¢–ò–ß–ù–´–ô! |
| 6 | –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏ | ? | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏ |
| 7 | –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π | ? | –ö–†–ò–¢–ò–ß–ù–´–ô! |

---

## üîç –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –¢–ï–°–¢–´

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram
```
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: python salon_bot.py
2. –û—Ç–∫—Ä—ã—Ç—å Telegram –∏ –Ω–∞–π—Ç–∏ –±–æ—Ç–∞
3. –ü—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ –≤—ã—à–µ
4. –ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü—É
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã pytest
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
pip install pytest pytest-asyncio

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
pytest test_*.py -v

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
pytest test_validation.py -v

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest test_validation.py::TestValidationSystem::test_valid_future_time -v
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Colab
```python
# –í Colab –∑–∞–ø—É—Å—Ç–∏—Ç—å:
!cat logs/bot.log | tail -100

# –ü–æ–∏—Å–∫–∞—Ç—å –æ—à–∏–±–∫–∏:
!grep "ERROR" logs/bot.log
!grep "Exception" logs/bot.log
```

---

**–î–∞—Ç–∞**: 16 –Ω–æ—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
